{"ast":null,"code":"import React from 'react';\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n/* global Reflect, Promise */\n\nvar extendStatics = function (d, b) {\n  extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n  };\n  return extendStatics(d, b);\n};\nfunction __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() {\n    this.constructor = d;\n  }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\n\n/**\n * Copied from fbjs is-shallow-equal\n */\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n/**\n * inlined Object.is polyfill to avoid requiring consumers ship their own\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is\n */\nfunction is(x, y) {\n  // SameValue algorithm\n  if (x === y) {\n    // Steps 1-5, 7-10\n    // Steps 6.b-6.e: +0 != -0\n    // Added the nonzero y check to make Flow happy, but it is redundant\n    return x !== 0 || y !== 0 || 1 / x === 1 / y;\n  } else {\n    // Step 6.a: NaN == NaN\n    return x !== x && y !== y;\n  }\n}\n/**\n * Performs equality by iterating through keys on an object and returning false\n * when any key has values which are not strictly equal between the arguments.\n * Returns true when the values of all keys are strictly equal.\n */\nfunction shallowEqual(objA, objB) {\n  if (is(objA, objB)) {\n    return true;\n  }\n  if (typeof objA !== 'object' || objA === null || typeof objB !== 'object' || objB === null) {\n    return false;\n  }\n  var keysA = Object.keys(objA);\n  var keysB = Object.keys(objB);\n  if (keysA.length !== keysB.length) {\n    return false;\n  }\n  // Test for A's keys different from B.\n  for (var i = 0; i < keysA.length; i++) {\n    if (!hasOwnProperty.call(objB, keysA[i]) || !is(objA[keysA[i]], objB[keysA[i]])) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Special symbol which might be used to delete properties\n * from an object calling [State.set](#set) or [State.merge](#merge).\n *\n * [Learn more...](https://hookstate.js.org/docs/nested-state#deleting-existing-element)\n */\nvar none = Symbol('none');\n// type PickByType<T, U, B = false> = Pick<T, KeysOfType<T, U, B>>;\n/**\n * A symbol which is used for type inference marking.\n *\n * @hidden\n * @ignore\n */\nvar __state = Symbol('__state');\nfunction hookstate(initial, extension) {\n  var store = createStore(initial);\n  store.activate(extension);\n  var methods = store.toMethods();\n  return methods.self();\n}\n/**\n * A method to destroy a global state and resources allocated by the extensions\n */\nfunction destroy(state) {\n  state[self].deactivate();\n}\n/**\n * A method to check if a variable is an instance of Hookstate State\n */\nfunction isHookstate(v) {\n  return !!(v === null || v === void 0 ? void 0 : v[self]);\n}\n/**\n * A method to check if a variable is an instance of traced (wrapped in a proxy) Hookstate Value\n */\nfunction isHookstateValue(v) {\n  return !!(v === null || v === void 0 ? void 0 : v[SelfMethodsID]);\n}\n/**\n * A function combines multiple extensions into one extension and returns it\n * Browse an example [here](https://hookstate.js.org/docs/extensions-snapshotable)\n */\nfunction extend(e1, e2, e3, e4, e5) {\n  function extended(extensions) {\n    var exts = extensions.map(function (i) {\n      return i();\n    });\n    var onInitCbs = exts.map(function (i) {\n      return i.onInit;\n    }).filter(function (i) {\n      return i;\n    });\n    var onPremergeCbs = exts.map(function (i) {\n      return i.onPremerge;\n    }).filter(function (i) {\n      return i;\n    });\n    var onPresetCbs = exts.map(function (i) {\n      return i.onPreset;\n    }).filter(function (i) {\n      return i;\n    });\n    var onSetCbs = exts.map(function (i) {\n      return i.onSet;\n    }).filter(function (i) {\n      return i;\n    });\n    var onDestroyCbs = exts.map(function (i) {\n      return i.onDestroy;\n    }).filter(function (i) {\n      return i;\n    });\n    var result = {\n      onCreate: function (instanceFactory, combinedMethods) {\n        for (var _i = 0, exts_1 = exts; _i < exts_1.length; _i++) {\n          var ext = exts_1[_i];\n          if (ext.onCreate) {\n            var extMethods = ext.onCreate(instanceFactory, combinedMethods);\n            Object.assign(combinedMethods, extMethods);\n          }\n        }\n        return combinedMethods;\n      }\n    };\n    if (onInitCbs.length > 0) {\n      result.onInit = function (s, e) {\n        for (var _i = 0, onInitCbs_1 = onInitCbs; _i < onInitCbs_1.length; _i++) {\n          var cb = onInitCbs_1[_i];\n          cb(s, e);\n        }\n      };\n    }\n    if (onPremergeCbs.length > 0) {\n      result.onPremerge = function (s, d, r) {\n        for (var _i = 0, onPremergeCbs_1 = onPremergeCbs; _i < onPremergeCbs_1.length; _i++) {\n          var cb = onPremergeCbs_1[_i];\n          cb(s, d, r);\n        }\n      };\n    }\n    if (onPresetCbs.length > 0) {\n      result.onPreset = function (s, d, r) {\n        for (var _i = 0, onPresetCbs_1 = onPresetCbs; _i < onPresetCbs_1.length; _i++) {\n          var cb = onPresetCbs_1[_i];\n          cb(s, d, r);\n        }\n      };\n    }\n    if (onSetCbs.length > 0) {\n      result.onSet = function (s, d, r) {\n        for (var _i = 0, onSetCbs_1 = onSetCbs; _i < onSetCbs_1.length; _i++) {\n          var cb = onSetCbs_1[_i];\n          cb(s, d, r);\n        }\n      };\n    }\n    if (onDestroyCbs.length > 0) {\n      result.onDestroy = function (s) {\n        for (var _i = 0, onDestroyCbs_1 = onDestroyCbs; _i < onDestroyCbs_1.length; _i++) {\n          var cb = onDestroyCbs_1[_i];\n          cb(s);\n        }\n      };\n    }\n    return result;\n  }\n  return function () {\n    return extended([e1, e2, e3, e4, e5].filter(function (i) {\n      return i;\n    }));\n  };\n}\nfunction useHookstate(source, extension) {\n  var parentMethods = Object(source) === source ? source[self] : undefined;\n  if (parentMethods) {\n    if (parentMethods.isMounted) {\n      // Scoped state mount\n      // eslint-disable-next-line react-hooks/rules-of-hooks\n      var initializer = function () {\n        // warning: this is called twice in react strict mode\n        var store = parentMethods.store;\n        var onSetUsedCallback = function () {\n          return setValue_1({\n            store: store,\n            state: state,\n            source: value_1.source // mutable, get the latest from value\n          });\n        };\n\n        var state = new StateMethodsImpl(store, parentMethods.path, store.get(parentMethods.path), store.edition, onSetUsedCallback);\n        return {\n          store: store,\n          state: state,\n          source: source\n        };\n      };\n      var _a = React.useState(initializer),\n        value_1 = _a[0],\n        setValue_1 = _a[1];\n      if (value_1.store !== parentMethods.store || !('source' in value_1)) {\n        throw new StateInvalidUsageError(parentMethods.path, ErrorId.InitStateStoreSwitchover);\n      }\n      // TODO move to a class hide props on prototype level\n      // hide props from development tools\n      Object.defineProperty(value_1, 'store', {\n        enumerable: false\n      });\n      Object.defineProperty(value_1, 'state', {\n        enumerable: false\n      });\n      Object.defineProperty(value_1, 'source', {\n        enumerable: false\n      });\n      value_1.state.reconstruct(parentMethods.path, value_1.store.get(parentMethods.path), value_1.store.edition,\n      // parent state object has changed its reference object\n      // so the scopped state should change too\n      value_1.source !== source);\n      value_1.source = source;\n      // need to subscribe in sync mode, because\n      // safari delays calling the effect giving priority to timeouts and network events,\n      // which can cause the state update\n      parentMethods.subscribe(value_1.state); // no-op if already subscribed\n      useIsomorphicLayoutEffect(function () {\n        // warning: in strict mode, effect is called twice\n        // so need to restore subscription and reconstruct the extension\n        // after the first effect unmount callback\n        value_1.state.onMount(); // no-op if already mounted\n        parentMethods.subscribe(value_1.state); // no-op if already subscribed\n        return function () {\n          value_1.state.onUnmount();\n          parentMethods.unsubscribe(value_1.state);\n        };\n      }, []);\n      var state = value_1.state.self();\n      // expose property in development tools\n      value_1['[hookstate(scoped)]'] = state; // TODO use label here, add core extension to label states\n      return state;\n    } else {\n      // Global state mount or destroyed link\n      // eslint-disable-next-line react-hooks/rules-of-hooks\n      var initializer = function () {\n        // warning: this is called twice in react strict mode\n        var store = parentMethods.store;\n        var onSetUsedCallback = function () {\n          return setValue_2({\n            store: store,\n            state: state,\n            source: value_2.source // mutable, get the latest from value\n          });\n        };\n\n        var state = new StateMethodsImpl(store, RootPath, store.get(RootPath), store.edition, onSetUsedCallback);\n        return {\n          store: store,\n          state: state,\n          source: source\n        };\n      };\n      var _b = React.useState(initializer),\n        value_2 = _b[0],\n        setValue_2 = _b[1];\n      if (value_2.store !== parentMethods.store || !('source' in value_2)) {\n        throw new StateInvalidUsageError(parentMethods.path, ErrorId.InitStateStoreSwitchover);\n      }\n      // hide props from development tools\n      Object.defineProperty(value_2, 'store', {\n        enumerable: false\n      });\n      Object.defineProperty(value_2, 'state', {\n        enumerable: false\n      });\n      Object.defineProperty(value_2, 'source', {\n        enumerable: false\n      });\n      value_2.state.reconstruct(RootPath, value_2.store.get(RootPath), value_2.store.edition,\n      // parent state object has changed its reference object\n      // so the scopped state should change too\n      value_2.source !== source);\n      value_2.source = source;\n      // need to subscribe in sync mode, because\n      // safari delays calling the effect giving priority to timeouts and network events,\n      // which can cause the state update\n      value_2.store.subscribe(value_2.state); // no-op if already subscribed\n      useIsomorphicLayoutEffect(function () {\n        // warning: in strict mode, effect is called twice\n        // so need to restore subscription and reconstruct the extension\n        // after the first effect unmount callback\n        value_2.state.onMount(); // no-op if already mounted\n        value_2.store.subscribe(value_2.state); // no-op if already subscribed\n        return function () {\n          value_2.state.onUnmount();\n          value_2.store.unsubscribe(value_2.state);\n        };\n      }, []);\n      var state = value_2.state.self();\n      for (var ind = 0; ind < parentMethods.path.length; ind += 1) {\n        state = state.nested(parentMethods.path[ind]);\n      }\n      // expose property in development tools\n      value_2['[hookstate(global)]'] = state; // TODO use label here, add core extension to label states\n      return state;\n    }\n  } else {\n    // Local state mount\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    var initializer = function () {\n      // warning: this is called twice in react strict mode\n      var store = createStore(source);\n      var onSetUsedCallback = function () {\n        return setValue_3({\n          store: store,\n          state: state\n        });\n      };\n      var state = new StateMethodsImpl(store, RootPath, store.get(RootPath), store.edition, onSetUsedCallback);\n      return {\n        store: store,\n        state: state\n      };\n    };\n    var _c = React.useState(initializer),\n      value_3 = _c[0],\n      setValue_3 = _c[1];\n    if ('source' in value_3) {\n      throw new StateInvalidUsageError(RootPath, ErrorId.InitStateStoreSwitchover);\n    }\n    // hide props from development tools\n    Object.defineProperty(value_3, 'store', {\n      enumerable: false\n    });\n    Object.defineProperty(value_3, 'state', {\n      enumerable: false\n    });\n    value_3.state.reconstruct(RootPath, value_3.store.get(RootPath), value_3.store.edition, false);\n    // need to subscribe in sync mode, because\n    // safari delays calling the effect giving priority to timeouts and network events,\n    // which can cause the state update\n    value_3.store.subscribe(value_3.state); // no-op if already subscribed\n    // need to attach the extension straight away\n    // because extension methods are used in render function\n    // and we can not defer it to the effect callback\n    value_3.store.activate(extension); // no-op if already attached\n    useIsomorphicLayoutEffect(function () {\n      // warning: in strict mode, effect is called twice\n      // so need to restore subscription and reconstruct the extension\n      // after the first effect unmount callback\n      value_3.state.onMount(); // no-op if already mounted\n      value_3.store.subscribe(value_3.state); // no-op if already subscribed\n      value_3.store.activate(extension); // no-op if already attached\n      return function () {\n        value_3.state.onUnmount();\n        value_3.store.unsubscribe(value_3.state);\n        value_3.store.deactivate(); // this will destroy the extensions\n      };\n    }, []);\n    var state = value_3.state.self();\n    // expose property in development tools\n    value_3['[hookstate(local)]'] = state; // TODO use label here, add core extension to label states\n    return state;\n  }\n}\nfunction StateFragment(props) {\n  var scoped = useHookstate(props.state, props.extension);\n  return props.suspend && suspend(scoped) || props.children(scoped);\n}\n/**\n * If state is promised, then it returns a component which integrates with React 18 Suspend feature automatically.\n * Note, that React 18 Suspend support for data loading is still experimental,\n * but it worked as per our experiments and testing.\n */\nfunction suspend(state) {\n  var p = state.promise;\n  return p && React.createElement(React.lazy(function () {\n    return p;\n  }));\n}\n///\n/// INTERNAL SYMBOLS (LIBRARY IMPLEMENTATION)\n///\nvar self = Symbol('self');\nvar ErrorId;\n(function (ErrorId) {\n  ErrorId[ErrorId[\"StateUsedInDependencyList\"] = 100] = \"StateUsedInDependencyList\";\n  ErrorId[ErrorId[\"InitStateToValueFromState\"] = 101] = \"InitStateToValueFromState\";\n  ErrorId[ErrorId[\"SetStateToValueFromState\"] = 102] = \"SetStateToValueFromState\";\n  ErrorId[ErrorId[\"GetStateWhenPromised\"] = 103] = \"GetStateWhenPromised\";\n  ErrorId[ErrorId[\"SetStateWhenPromised\"] = 104] = \"SetStateWhenPromised\";\n  ErrorId[ErrorId[\"SetStateNestedToPromised\"] = 105] = \"SetStateNestedToPromised\";\n  ErrorId[ErrorId[\"SetStateWhenDestroyed\"] = 106] = \"SetStateWhenDestroyed\";\n  ErrorId[ErrorId[\"ToJson_Value\"] = 108] = \"ToJson_Value\";\n  ErrorId[ErrorId[\"ToJson_State\"] = 109] = \"ToJson_State\";\n  ErrorId[ErrorId[\"GetProperty_Function\"] = 110] = \"GetProperty_Function\";\n  ErrorId[ErrorId[\"InitStateStoreSwitchover\"] = 111] = \"InitStateStoreSwitchover\";\n  ErrorId[ErrorId[\"GetUnknownPlugin\"] = 120] = \"GetUnknownPlugin\";\n  ErrorId[ErrorId[\"SetProperty_State\"] = 201] = \"SetProperty_State\";\n  ErrorId[ErrorId[\"SetProperty_Value\"] = 202] = \"SetProperty_Value\";\n  ErrorId[ErrorId[\"SetPrototypeOf_State\"] = 203] = \"SetPrototypeOf_State\";\n  ErrorId[ErrorId[\"SetPrototypeOf_Value\"] = 204] = \"SetPrototypeOf_Value\";\n  ErrorId[ErrorId[\"PreventExtensions_State\"] = 205] = \"PreventExtensions_State\";\n  ErrorId[ErrorId[\"PreventExtensions_Value\"] = 206] = \"PreventExtensions_Value\";\n  ErrorId[ErrorId[\"DefineProperty_State\"] = 207] = \"DefineProperty_State\";\n  ErrorId[ErrorId[\"DefineProperty_Value\"] = 208] = \"DefineProperty_Value\";\n  ErrorId[ErrorId[\"DeleteProperty_State\"] = 209] = \"DeleteProperty_State\";\n  ErrorId[ErrorId[\"DeleteProperty_Value\"] = 210] = \"DeleteProperty_Value\";\n  ErrorId[ErrorId[\"Construct_State\"] = 211] = \"Construct_State\";\n  ErrorId[ErrorId[\"Construct_Value\"] = 212] = \"Construct_Value\";\n  ErrorId[ErrorId[\"Apply_State\"] = 213] = \"Apply_State\";\n  ErrorId[ErrorId[\"Apply_Value\"] = 214] = \"Apply_Value\";\n})(ErrorId || (ErrorId = {}));\nvar StateInvalidUsageError = /** @class */function (_super) {\n  __extends(StateInvalidUsageError, _super);\n  function StateInvalidUsageError(path, id, details) {\n    return _super.call(this, \"Error: HOOKSTATE-\".concat(id, \" [path: /\").concat(path.join('/')).concat(details ? \", details: \".concat(details) : '', \"]. \") + \"See https://hookstate.js.org/docs/exceptions#hookstate-\".concat(id)) || this;\n  }\n  return StateInvalidUsageError;\n}(Error);\nvar SelfMethodsID = Symbol('ProxyMarker');\nvar RootPath = [];\nvar Store = /** @class */function () {\n  function Store(_value) {\n    var _this = this;\n    this._value = _value;\n    // > 0 means active store, < 0 means destroyed\n    // please note, in react strict mode and hot reload cases\n    // state can be reused, so we should support store resurection\n    this.edition = 1;\n    this._subscribers = new Set();\n    if (Object(_value) === _value && configuration.promiseDetector(_value)) {\n      this.setPromised(_value);\n    } else if (_value === none) {\n      this.setPromised(undefined);\n    }\n    var onSetUsedStoreStateMethods = function () {\n      _this._stateMethods.reconstruct(RootPath, _this.get(RootPath), _this.edition, false);\n    };\n    onSetUsedStoreStateMethods[IsUnmounted] = true;\n    this._stateMethods = new StateMethodsImpl(this, RootPath, this.get(RootPath), this.edition, onSetUsedStoreStateMethods);\n    this.subscribe(this._stateMethods);\n  }\n  Store.prototype.setPromised = function (promise) {\n    var _this = this;\n    this._value = none;\n    this._promiseError = undefined;\n    this._promiseResolver = undefined;\n    if (!promise) {\n      this._promise = new Promise(function (resolve) {\n        _this._promiseResolver = resolve;\n      });\n      return;\n    }\n    promise = promise.then(function (r) {\n      if (_this._promise === promise) {\n        _this._promise = undefined;\n        _this._promiseError = undefined;\n        _this._promiseResolver === undefined;\n        _this.update(_this._stateMethods.self(), _this.set(RootPath, r));\n      }\n    }).catch(function (err) {\n      if (_this._promise === promise) {\n        _this._promise = undefined;\n        _this._promiseResolver = undefined;\n        _this._promiseError = err;\n        _this.edition += 1;\n        var ad = {\n          path: RootPath\n        };\n        _this.update(_this._stateMethods.self(), ad);\n      }\n    });\n    this._promise = promise;\n  };\n  Store.prototype.activate = function (extensionFactory) {\n    var _a, _b, _c, _d;\n    if (this.edition < 0) {\n      this.edition = -this.edition;\n    }\n    if (this._extension === undefined) {\n      this._extension = extensionFactory === null || extensionFactory === void 0 ? void 0 : extensionFactory();\n      this._extensionMethods = (_b = (_a = this._extension) === null || _a === void 0 ? void 0 : _a.onCreate) === null || _b === void 0 ? void 0 : _b.call(_a, this._stateMethods.self(), {});\n      // this is invoked with all extension methods activated on the state\n      (_d = (_c = this._extension) === null || _c === void 0 ? void 0 : _c.onInit) === null || _d === void 0 ? void 0 : _d.call(_c, this._stateMethods.self(), this._extensionMethods || {});\n    }\n  };\n  Store.prototype.deactivate = function () {\n    var _a, _b;\n    if (this._extension) {\n      (_b = (_a = this._extension).onDestroy) === null || _b === void 0 ? void 0 : _b.call(_a, this._stateMethods.self());\n      delete this._extension;\n      delete this._extensionMethods;\n    }\n    if (this.edition > 0) {\n      this.edition = -this.edition;\n    }\n  };\n  Object.defineProperty(Store.prototype, \"extension\", {\n    get: function () {\n      return this._extensionMethods;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Store.prototype, \"promise\", {\n    get: function () {\n      return this._promise;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Store.prototype, \"promiseError\", {\n    get: function () {\n      return this._promiseError;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Store.prototype.get = function (path) {\n    var result = this._value;\n    if (result === none) {\n      return result;\n    }\n    path.forEach(function (p) {\n      result = result[p];\n    });\n    return result;\n  };\n  Store.prototype.set = function (path, value) {\n    var _a, _b;\n    if (this.edition < 0) {\n      // TODO convert to console log\n      throw new StateInvalidUsageError(path, ErrorId.SetStateWhenDestroyed);\n    }\n    if (path.length === 0) {\n      // Root value UPDATE case,\n      if (value === none) {\n        this.setPromised(undefined);\n      } else if (Object(value) === value && configuration.promiseDetector(value)) {\n        this.setPromised(value);\n        value = none;\n      } else if (this._promise && !this._promiseResolver) {\n        throw new StateInvalidUsageError(path, ErrorId.SetStateWhenPromised);\n      } else {\n        this._promiseError = undefined;\n      }\n      var prevValue = this._value;\n      this._value = value;\n      this.afterSet();\n      if (prevValue === none && this._value !== none && this._promiseResolver) {\n        this._promise = undefined;\n        this._promiseError = undefined;\n        var resolver = this._promiseResolver;\n        this._promiseResolver === undefined;\n        resolver(this._value);\n      }\n      return {\n        path: path\n      };\n    }\n    if (Object(value) === value && configuration.promiseDetector(value)) {\n      // TODO this one still can get into the state as nested property, need to check on read instead\n      throw new StateInvalidUsageError(path, ErrorId.SetStateNestedToPromised);\n    }\n    var target = this._value;\n    for (var i = 0; i < path.length - 1; i += 1) {\n      target = target[path[i]];\n    }\n    var p = path[path.length - 1];\n    if (p in target) {\n      if (value !== none) {\n        // Property UPDATE case\n        target[p] = value;\n        this.afterSet();\n        return {\n          path: path\n        };\n      } else {\n        // Property DELETE case\n        if (Array.isArray(target) && typeof p === 'number') {\n          target.splice(p, 1);\n        } else {\n          delete target[p];\n        }\n        this.afterSet();\n        // if an array of objects is about to loose existing property\n        // we consider it is the whole object is changed\n        // which is identified by upper path\n        return {\n          path: path.slice(0, -1),\n          actions: (_a = {}, _a[p] = \"D\", _a)\n        };\n      }\n    }\n    if (value !== none) {\n      // Property INSERT case\n      target[p] = value;\n      this.afterSet();\n      // if an array of objects is about to be extended by new property\n      // we consider it is the whole object is changed\n      // which is identified by upper path\n      return {\n        path: path.slice(0, -1),\n        actions: (_b = {}, _b[p] = \"I\", _b)\n      };\n    }\n    // Non-existing property DELETE case\n    // no-op\n    return {\n      path: path\n    };\n  };\n  Store.prototype.preset = function (state, value) {\n    var _a, _b;\n    (_b = (_a = this._extension) === null || _a === void 0 ? void 0 : _a.onPreset) === null || _b === void 0 ? void 0 : _b.call(_a, state, value, this._stateMethods.self());\n  };\n  Store.prototype.premerge = function (state, value) {\n    var _a, _b;\n    (_b = (_a = this._extension) === null || _a === void 0 ? void 0 : _a.onPremerge) === null || _b === void 0 ? void 0 : _b.call(_a, state, value, this._stateMethods.self());\n  };\n  Store.prototype.update = function (state, ad) {\n    var _this = this;\n    var _a, _b;\n    (_b = (_a = this._extension) === null || _a === void 0 ? void 0 : _a.onSet) === null || _b === void 0 ? void 0 : _b.call(_a, state, ad, this._stateMethods.self());\n    var actions = new Set();\n    // check if actions descriptor can be unfolded into a number of individual update actions\n    // this is the case when merge call swaps to properties for example\n    // so we optimize rerendering only these properties\n    if (ad.actions && Object.values(ad.actions).findIndex(function (i) {\n      return i !== \"U\";\n    }) === -1) {\n      // all actions are update actions\n      Object.keys(ad.actions).forEach(function (key) {\n        _this._subscribers.forEach(function (s) {\n          return s.onSet({\n            path: ad.path.concat(key)\n          }, actions);\n        });\n      });\n    } else {\n      this._subscribers.forEach(function (s) {\n        return s.onSet(ad, actions);\n      });\n    }\n    actions.forEach(function (a) {\n      return a();\n    });\n  };\n  Store.prototype.afterSet = function () {\n    if (this.edition > 0) {\n      this.edition += 1;\n    }\n    if (this.edition < 0) {\n      this.edition -= 1;\n    }\n  };\n  Store.prototype.toMethods = function () {\n    return this._stateMethods;\n  };\n  Store.prototype.subscribe = function (l) {\n    this._subscribers.add(l);\n  };\n  Store.prototype.unsubscribe = function (l) {\n    this._subscribers.delete(l);\n  };\n  Store.prototype.toJSON = function () {\n    throw new StateInvalidUsageError(RootPath, ErrorId.ToJson_Value);\n  };\n  return Store;\n}();\n// use symbol property to allow for easier reference finding\nvar UnusedValue = Symbol('UnusedValue');\n// use symbol to mark that a function has no effect anymore\nvar IsUnmounted = Symbol('IsUnmounted');\nvar StateMethodsImpl = /** @class */function () {\n  function StateMethodsImpl(store, path, valueSource, valueEdition, onSetUsed) {\n    this.store = store;\n    this.path = path;\n    this.valueSource = valueSource;\n    this.valueEdition = valueEdition;\n    this.onSetUsed = onSetUsed;\n    this.valueUsed = UnusedValue;\n  }\n  Object.defineProperty(StateMethodsImpl.prototype, __state, {\n    get: function () {\n      return [this.get(), this.self()];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  StateMethodsImpl.prototype.reconstruct = function (path, valueSource, valueEdition, reset) {\n    this.path = path;\n    this.valueSource = valueSource;\n    this.valueEdition = valueEdition;\n    this.valueUsed = UnusedValue;\n    if (reset) {\n      delete this.selfUsed;\n      delete this.childrenCreated;\n      delete this.childrenUsedPrevious;\n    } else {\n      this.valueUsedNoProxyPrevious = this.valueUsedNoProxy;\n      this.childrenUsedPrevious = this.childrenUsed;\n    }\n    delete this.valueUsedNoProxy;\n    delete this.childrenUsed;\n    // We should not delete subscribers as these are self cleaned up when unmounted\n    // Theoretically it is possible to reconnect subscribers like we done it for \n    // children, but it is easier and more efficient to leave subscribers to have independent lifecycle\n    // If we delete subscribers here, scoped states wrapped in React.memo\n    // will lose state change propagation and rerendering for scopped states\n    // delete this.subscribers;\n  };\n\n  StateMethodsImpl.prototype.reconnect = function () {\n    // Mark it's as used, because it is used in a dependency list\n    // (we are making it's value used implicitly, so rerender is triggered).\n    // Otherwise, no rerender => no effects running, even when a value is changed.\n    // This is marking the state used a bit more than it might be really used\n    // in the effect callback. More optimized / precise implementation would be\n    // to remember useSelf as previous (similar to childrenUsed),\n    // but it is a lot more complicated and the benefit is not worth the complexity.\n    // So, mark it used.\n    // We also using it without proxy if it wass used without proxy during the\n    // previous render, because otherwise children usage might be not traced completely\n    // and so will not result in renreder if children are updated.\n    // This is covered by some tests, but there are so many possible corner cases...\n    this.get({\n      __internalAllowPromised: true,\n      noproxy: this.valueUsedNoProxyPrevious\n    });\n    this.childrenUsed = __assign(__assign({}, this.childrenUsedPrevious), this.childrenUsed);\n  };\n  StateMethodsImpl.prototype.getUntracked = function (__internalAllowPromised) {\n    if (this.valueEdition !== this.store.edition) {\n      this.valueSource = this.store.get(this.path);\n      this.valueEdition = this.store.edition;\n      if (this.valueUsed !== UnusedValue) {\n        this.valueUsed = UnusedValue;\n        this.get({\n          __internalAllowPromised: true\n        }); // renew cache to keep it marked used\n      }\n    }\n\n    if (__internalAllowPromised) {\n      return this.valueSource;\n    }\n    if (this.store.promiseError) {\n      throw this.store.promiseError;\n    }\n    if (this.store.promise) {\n      throw new StateInvalidUsageError(this.path, ErrorId.GetStateWhenPromised);\n    }\n    return this.valueSource;\n  };\n  StateMethodsImpl.prototype.get = function (options) {\n    var _a;\n    var valueSource = this.getUntracked(options === null || options === void 0 ? void 0 : options.__internalAllowPromised);\n    if (options === null || options === void 0 ? void 0 : options.stealth) {\n      return valueSource;\n    }\n    if (this.valueUsed === UnusedValue) {\n      if (Array.isArray(valueSource)) {\n        this.valueUsed = this.valueArrayImpl(valueSource);\n      } else if (Object(valueSource) === valueSource) {\n        if (((_a = valueSource.constructor) === null || _a === void 0 ? void 0 : _a.name) === \"Object\") {\n          this.valueUsed = this.valueObjectImpl(valueSource);\n        } else {\n          // any other object except Object, for example Date\n          this.valueUsedNoProxy = true;\n          this.valueUsed = valueSource;\n        }\n      } else {\n        this.valueUsed = valueSource;\n      }\n    }\n    if (options === null || options === void 0 ? void 0 : options.noproxy) {\n      this.valueUsedNoProxy = true;\n      return valueSource;\n    }\n    return this.valueUsed;\n  };\n  Object.defineProperty(StateMethodsImpl.prototype, \"value\", {\n    get: function () {\n      // various tools, including react dev tools and webpack import\n      // inspect an object and it's properties\n      // so these should not throw\n      // return this.get({ __internalAllowPromised: true })\n      return this.get();\n    },\n    enumerable: false,\n    configurable: true\n  });\n  StateMethodsImpl.prototype.setUntrackedV4 = function (newValue) {\n    if (typeof newValue === 'function') {\n      newValue = newValue(this.getUntracked());\n    }\n    this.store.preset(this.self(), newValue);\n    if (Object(newValue) === newValue && newValue[SelfMethodsID]) {\n      // TODO check on read instead as it might escape as nested on set anyway\n      throw new StateInvalidUsageError(this.path, ErrorId.SetStateToValueFromState);\n    }\n    if (newValue !== Object(newValue) && newValue === this.getUntracked(true)) {\n      // this is primitive value and has not changed\n      // so skip this set call as it does not make an effect\n      return null;\n    }\n    return this.store.set(this.path, newValue);\n  };\n  StateMethodsImpl.prototype.set = function (newValue) {\n    var ad = this.setUntrackedV4(newValue);\n    if (ad) {\n      this.store.update(this.self(), ad);\n    }\n  };\n  StateMethodsImpl.prototype.mergeUntracked = function (sourceValue) {\n    var r = this.mergeUntrackedV4(sourceValue);\n    if (r) {\n      return [r.path];\n    }\n    return [];\n  };\n  StateMethodsImpl.prototype.mergeUntrackedV4 = function (sourceValue) {\n    var currentValue = this.getUntracked();\n    if (typeof sourceValue === 'function') {\n      sourceValue = sourceValue(currentValue);\n    }\n    this.store.premerge(this.self(), sourceValue);\n    if (Array.isArray(currentValue)) {\n      if (Array.isArray(sourceValue)) {\n        var ad_1 = {\n          path: this.path,\n          actions: {}\n        };\n        sourceValue.forEach(function (e, i) {\n          ad_1.actions[currentValue.push(e) - 1] = \"I\";\n        });\n        if (Object.keys(ad_1.actions).length > 0) {\n          this.setUntrackedV4(currentValue);\n          return ad_1;\n        }\n        return null;\n      } else {\n        var ad_2 = {\n          path: this.path,\n          actions: {}\n        };\n        var deletedIndexes_1 = [];\n        Object.keys(sourceValue).map(function (i) {\n          return Number(i);\n        }).sort(function (a, b) {\n          return a - b;\n        }).forEach(function (i) {\n          var index = Number(i);\n          var newPropValue = sourceValue[index];\n          if (newPropValue === none) {\n            ad_2.actions[index] = \"D\";\n            deletedIndexes_1.push(index);\n          } else {\n            if (index in currentValue) {\n              ad_2.actions[index] = \"U\";\n            } else {\n              ad_2.actions[index] = \"I\";\n            }\n            currentValue[index] = newPropValue;\n          }\n        });\n        // indexes are ascending sorted as per above\n        // so, delete one by one from the end\n        // this way index positions do not change\n        deletedIndexes_1.reverse().forEach(function (p) {\n          currentValue.splice(p, 1);\n        });\n        if (Object.keys(ad_2.actions).length > 0) {\n          this.setUntrackedV4(currentValue);\n          return ad_2;\n        }\n        return null;\n      }\n    } else if (Object(currentValue) === currentValue) {\n      var ad_3 = {\n        path: this.path,\n        actions: {}\n      };\n      Object.keys(sourceValue).forEach(function (key) {\n        var newPropValue = sourceValue[key];\n        if (newPropValue === none) {\n          ad_3.actions[key] = \"D\";\n          delete currentValue[key];\n        } else {\n          if (key in currentValue) {\n            ad_3.actions[key] = \"U\";\n          } else {\n            ad_3.actions[key] = \"I\";\n          }\n          currentValue[key] = newPropValue;\n        }\n      });\n      if (Object.keys(ad_3.actions).length > 0) {\n        this.setUntrackedV4(currentValue);\n        return ad_3;\n      }\n      return null;\n    } else if (typeof currentValue === 'string') {\n      return this.setUntrackedV4(currentValue + String(sourceValue));\n    } else {\n      return this.setUntrackedV4(sourceValue);\n    }\n  };\n  StateMethodsImpl.prototype.merge = function (sourceValue) {\n    var r = this.mergeUntrackedV4(sourceValue);\n    if (r) {\n      this.store.update(this.self(), r);\n    }\n  };\n  StateMethodsImpl.prototype.nested = function (key) {\n    return this.child(key).self();\n  };\n  StateMethodsImpl.prototype.rerender = function (paths) {\n    for (var _i = 0, paths_1 = paths; _i < paths_1.length; _i++) {\n      var path = paths_1[_i];\n      this.store.update(this.self(), {\n        path: path\n      });\n    }\n  };\n  StateMethodsImpl.prototype.activate = function (extensionFactory) {\n    this.store.activate(extensionFactory);\n  };\n  StateMethodsImpl.prototype.deactivate = function () {\n    this.store.deactivate();\n  };\n  StateMethodsImpl.prototype.subscribe = function (l) {\n    if (this.subscribers === undefined) {\n      this.subscribers = new Set();\n    }\n    this.subscribers.add(l);\n  };\n  StateMethodsImpl.prototype.unsubscribe = function (l) {\n    if (this.subscribers) {\n      this.subscribers.delete(l);\n    }\n  };\n  Object.defineProperty(StateMethodsImpl.prototype, \"isMounted\", {\n    get: function () {\n      return !this.onSetUsed[IsUnmounted];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  StateMethodsImpl.prototype.onMount = function () {\n    delete this.onSetUsed[IsUnmounted];\n  };\n  StateMethodsImpl.prototype.onUnmount = function () {\n    this.onSetUsed[IsUnmounted] = true;\n  };\n  StateMethodsImpl.prototype.onSet = function (ad, actions) {\n    var _this = this;\n    var update = function () {\n      var _a;\n      var isAffected = false;\n      if (_this.valueUsedNoProxy\n      // TODO this condition becomes redundant when Downgraded plugins is deleted\n      && _this.valueUsed !== UnusedValue) {\n        actions.add(_this.onSetUsed);\n        delete _this.selfUsed;\n        isAffected = true;\n      }\n      var path = ad.path;\n      var nextChildKey = path[_this.path.length];\n      if (nextChildKey === undefined) {\n        // There is no next child to dive into\n        // So it is this one which was updated\n        if (_this.valueUsed !== UnusedValue) {\n          actions.add(_this.onSetUsed);\n          delete _this.selfUsed;\n          delete _this.childrenUsed;\n          if (ad.actions && _this.childrenCreated) {\n            // TODO add automated unit tests for this part\n            if (Array.isArray(_this.valueSource) && Object.values(ad.actions).includes(\"D\")) {\n              // this is an array and some elements were removed\n              // so invalidate cache for all children after the first deleted\n              var firstDeletedIndex = Object.keys(ad.actions).map(function (i) {\n                return Number(i);\n              }).sort(function (a, b) {\n                return a - b;\n              }).find(function (i) {\n                var _a;\n                return ((_a = ad.actions) === null || _a === void 0 ? void 0 : _a[i]) === \"D\";\n              });\n              for (var childKey in _this.childrenCreated) {\n                if (Number(childKey) >= firstDeletedIndex || childKey in ad.actions) {\n                  delete _this.childrenCreated[childKey];\n                }\n              }\n            } else {\n              for (var childKey in ad.actions) {\n                delete _this.childrenCreated[childKey];\n              }\n            }\n          } else {\n            delete _this.childrenCreated;\n          }\n          return true;\n        }\n      } else {\n        var nextChild = (_a = _this.childrenUsed) === null || _a === void 0 ? void 0 : _a[nextChildKey];\n        if (nextChild && nextChild.onSet(ad, actions)) {\n          delete _this.selfUsed;\n          return true;\n        }\n      }\n      return isAffected;\n    };\n    var updated = update();\n    if (!updated && this.subscribers !== undefined) {\n      this.subscribers.forEach(function (s) {\n        if (s.onSet(ad, actions)) {\n          delete _this.selfUsed;\n        }\n      });\n    }\n    return updated;\n  };\n  Object.defineProperty(StateMethodsImpl.prototype, \"keys\", {\n    get: function () {\n      var value = this.get();\n      if (Array.isArray(value)) {\n        return Object.keys(value).map(function (i) {\n          return Number(i);\n        }).filter(function (i) {\n          return Number.isInteger(i);\n        });\n      }\n      if (Object(value) === value) {\n        return Object.keys(value);\n      }\n      return undefined;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  StateMethodsImpl.prototype.child = function (key) {\n    this.childrenUsed = this.childrenUsed || {};\n    var cachedChild = this.childrenUsed.hasOwnProperty(key) && this.childrenUsed[key];\n    if (cachedChild) {\n      return cachedChild;\n    }\n    var valueSource = this.valueSource[key];\n    if (typeof valueSource === 'function') {\n      // hitting a method of a custom type, should be no-op\n      throw new StateInvalidUsageError(this.path, ErrorId.GetProperty_Function);\n    }\n    this.childrenCreated = this.childrenCreated || {};\n    var child = this.childrenCreated[key];\n    var r;\n    if (child) {\n      child.reconstruct(this.path.concat(key), valueSource, this.valueEdition, false);\n      r = child;\n    } else {\n      r = new StateMethodsImpl(this.store, this.path.concat(key), valueSource, this.valueEdition, this.onSetUsed);\n      this.childrenCreated[key] = r;\n    }\n    if (this.valueUsedNoProxy) {\n      // TODO this is redundant when Downgraded plugin is deleted\n      r.valueUsedNoProxy = true;\n    }\n    this.childrenUsed[key] = r;\n    return r;\n  };\n  StateMethodsImpl.prototype.valueArrayImpl = function (currentValue) {\n    var _this = this;\n    return proxyWrap(this.path, currentValue, function () {\n      return currentValue;\n    }, function (target, key) {\n      if (key === 'length') {\n        return target.length;\n      }\n      if (key in Array.prototype) {\n        return Array.prototype[key];\n      }\n      if (key === SelfMethodsID) {\n        return _this;\n      }\n      if (typeof key === 'symbol') {\n        // allow clients to associate hidden cache with state values\n        return target[key];\n      }\n      var index = Number(key);\n      if (!Number.isInteger(index)) {\n        return undefined;\n      }\n      return _this.child(index).get();\n    }, function (target, key, value) {\n      if (typeof key === 'symbol') {\n        // allow clients to associate hidden cache with state values\n        target[key] = value;\n        return true;\n      }\n      throw new StateInvalidUsageError(_this.path, ErrorId.SetProperty_Value);\n    }, true);\n  };\n  StateMethodsImpl.prototype.valueObjectImpl = function (currentValue) {\n    var _this = this;\n    return proxyWrap(this.path, currentValue, function () {\n      return currentValue;\n    }, function (target, key) {\n      if (key in Object.prototype) {\n        return Object.prototype[key];\n      }\n      if (key === SelfMethodsID) {\n        return _this;\n      }\n      if (typeof key === 'symbol') {\n        // allow clients to associate hidden cache with state values\n        return target[key];\n      }\n      return _this.child(key).get();\n    }, function (target, key, value) {\n      if (typeof key === 'symbol') {\n        // allow clients to associate hidden cache with state values\n        target[key] = value;\n        return true;\n      }\n      throw new StateInvalidUsageError(_this.path, ErrorId.SetProperty_Value);\n    }, true);\n  };\n  StateMethodsImpl.prototype.self = function () {\n    var _this = this;\n    if (this.selfUsed) {\n      return this.selfUsed;\n    }\n    var getter = function (_, key) {\n      if (key === self) {\n        return _this;\n      }\n      if (typeof key === 'symbol') {\n        return undefined;\n      }\n      if (key === 'toJSON') {\n        throw new StateInvalidUsageError(_this.path, ErrorId.ToJson_State);\n      }\n      var nestedGetter = function (prop) {\n        var currentValue = _this.get({\n          __internalAllowPromised: prop === '$$typeof' || prop === 'constructor'\n        });\n        if (prop in Object.prototype) {\n          // Mark it used entirely, so changes to the value\n          // invalidate and rerender results for Object.prototype.toString(),\n          // for example.\n          // We check for Object prototype functions\n          // even for primitive values, because primitive values still\n          // can have object methods.\n          return Object.prototype[prop];\n        }\n        if (\n        // if currentValue is primitive type\n        Object(currentValue) !== currentValue &&\n        // if promised, it will be none\n        currentValue !== none) {\n          // This was an error case, but various tools like webpack bundler\n          // and react dev tools attempt to get props out of non-null object,\n          // so this was changed to return just undefined for any property request\n          // as there is no way to fix 3rd party tools.\n          // Logging a warning to console is also not an option\n          // as it pollutes console for legitimate apps on app start app.\n          // Ref: https://github.com/avkonst/hookstate/issues/125\n          return undefined;\n        }\n        if (Array.isArray(currentValue)) {\n          if (prop === 'length') {\n            return currentValue.length;\n          }\n          if (prop in Array.prototype) {\n            return Array.prototype[prop];\n          }\n          var index = Number(prop);\n          if (!Number.isInteger(index)) {\n            return undefined;\n          }\n          return _this.nested(index);\n        }\n        return _this.nested(prop.toString());\n      };\n      switch (key) {\n        case 'path':\n          return _this.path;\n        case 'keys':\n          return _this.keys;\n        case 'value':\n          return _this.value;\n        case 'ornull':\n          return _this.ornull;\n        case 'promised':\n          return _this.promised;\n        case 'promise':\n          return _this.promise;\n        case 'error':\n          return _this.error;\n        case 'get':\n          return function (opts) {\n            return _this.get(opts);\n          };\n        case 'set':\n          return function (p) {\n            return _this.set(p);\n          };\n        case 'merge':\n          return function (p) {\n            return _this.merge(p);\n          };\n        case 'nested':\n          return function (p) {\n            return nestedGetter(p);\n          };\n        default:\n          // check if extension method\n          var ext = _this.store.extension;\n          if (ext && key in ext) {\n            return ext[key](_this.self());\n          }\n          // otherwise nested child\n          return nestedGetter(key);\n      }\n    };\n    this.selfUsed = proxyWrap(this.path, this.valueSource, function (opts) {\n      return _this.get({\n        __internalAllowPromised: true,\n        stealth: opts === null || opts === void 0 ? void 0 : opts.stealth\n      });\n    }, getter, function (_, key, value) {\n      throw new StateInvalidUsageError(_this.path, ErrorId.SetProperty_State);\n    }, false);\n    return this.selfUsed;\n  };\n  Object.defineProperty(StateMethodsImpl.prototype, \"promised\", {\n    get: function () {\n      this.get({\n        __internalAllowPromised: true\n      }); // marks used\n      return !!this.store.promise;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateMethodsImpl.prototype, \"promise\", {\n    get: function () {\n      var _this = this;\n      var _a;\n      this.get({\n        __internalAllowPromised: true\n      }); // marks used\n      return (_a = this.store.promise) === null || _a === void 0 ? void 0 : _a.then(function (_) {\n        return _this.self();\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateMethodsImpl.prototype, \"error\", {\n    get: function () {\n      this.get({\n        __internalAllowPromised: !!this.store.promiseError\n      }); // marks used\n      return this.store.promiseError;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateMethodsImpl.prototype, \"ornull\", {\n    get: function () {\n      var value = this.get();\n      if (value === null || value === undefined) {\n        return value;\n      }\n      return this.self();\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return StateMethodsImpl;\n}();\nfunction proxyWrap(path,\n// tslint:disable-next-line: no-any\ntargetBootstrap,\n// tslint:disable-next-line: no-any\ntargetGetter,\n// tslint:disable-next-line: no-any\npropertyGetter,\n// tslint:disable-next-line: no-any\npropertySetter, isValueProxy) {\n  var onInvalidUsage = function (op) {\n    throw new StateInvalidUsageError(path, op);\n  };\n  if (Object(targetBootstrap) !== targetBootstrap) {\n    targetBootstrap = {};\n  }\n  return new Proxy(targetBootstrap, {\n    getPrototypeOf: function (_target) {\n      // should satisfy the invariants:\n      // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getPrototypeOf#Invariants\n      var targetReal = targetGetter();\n      if (targetReal === undefined || targetReal === null) {\n        return null;\n      }\n      if (targetReal === none) {\n        return Object.getPrototypeOf(new Promise(function () {}));\n      }\n      return Object.getPrototypeOf(targetReal);\n    },\n    setPrototypeOf: function (_target, v) {\n      return onInvalidUsage(isValueProxy ? ErrorId.SetPrototypeOf_State : ErrorId.SetPrototypeOf_Value);\n    },\n    isExtensible: function (_target) {\n      // should satisfy the invariants:\n      // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/isExtensible#Invariants\n      return true; // required to satisfy the invariants of the getPrototypeOf\n      // return Object.isExtensible(target);\n    },\n\n    preventExtensions: function (_target) {\n      return onInvalidUsage(isValueProxy ? ErrorId.PreventExtensions_State : ErrorId.PreventExtensions_Value);\n    },\n    getOwnPropertyDescriptor: function (_target, p) {\n      var targetReal = targetGetter();\n      if (Object(targetReal) === targetReal) {\n        var origin_1 = Object.getOwnPropertyDescriptor(targetReal, p);\n        if (Array.isArray(targetReal) && p in Array.prototype) {\n          return origin_1;\n        }\n        return origin_1 && {\n          // should be configurable as may not exist on proxy target\n          configurable: true,\n          enumerable: origin_1.enumerable,\n          get: function () {\n            return propertyGetter(targetReal, p);\n          },\n          set: undefined\n        };\n      }\n      if (isValueProxy || targetReal === none) {\n        return undefined;\n      }\n      if (p === 'value') {\n        return {\n          // should be configurable as does not exist on proxy target\n          configurable: true,\n          enumerable: true,\n          get: function () {\n            return targetGetter({\n              stealth: true\n            });\n          },\n          set: undefined\n        };\n      }\n      if (p === 'path') {\n        return {\n          // should be configurable as does not exist on proxy target\n          configurable: true,\n          enumerable: true,\n          get: function () {\n            return path;\n          },\n          set: undefined\n        };\n      }\n      return undefined;\n    },\n    has: function (_target, p) {\n      if (typeof p === 'symbol') {\n        return false;\n      }\n      var targetReal = targetGetter();\n      if (Object(targetReal) === targetReal) {\n        return p in targetReal;\n      }\n      if (isValueProxy || targetReal === none) {\n        return false;\n      }\n      return p === 'value' || p === 'path';\n    },\n    get: propertyGetter,\n    set: propertySetter,\n    deleteProperty: function (_target, p) {\n      return onInvalidUsage(isValueProxy ? ErrorId.DeleteProperty_State : ErrorId.DeleteProperty_Value);\n    },\n    defineProperty: function (_target, p, attributes) {\n      return onInvalidUsage(isValueProxy ? ErrorId.DefineProperty_State : ErrorId.DefineProperty_Value);\n    },\n    ownKeys: function (_target) {\n      var targetReal = targetGetter();\n      if (Array.isArray(targetReal)) {\n        if (_target.length === undefined) {\n          // an object turned into an array now\n          // inject length property now as it is defined on the array\n          // to enable getOwnPropertyDescriptor for length not throw\n          Object.defineProperty(targetBootstrap, 'length', {\n            value: 0,\n            writable: true,\n            enumerable: false,\n            configurable: false\n          });\n        }\n      }\n      if (Object(targetReal) === targetReal) {\n        return Object.getOwnPropertyNames(targetReal);\n      }\n      if (isValueProxy || targetReal === none) {\n        return [];\n      }\n      return ['value', 'path'];\n    },\n    apply: function (_target, thisArg, argArray) {\n      return onInvalidUsage(isValueProxy ? ErrorId.Apply_State : ErrorId.Apply_Value);\n    },\n    construct: function (_target, argArray, newTarget) {\n      return onInvalidUsage(isValueProxy ? ErrorId.Construct_State : ErrorId.Construct_Value);\n    }\n  });\n}\nfunction createStore(initial) {\n  var initialValue = initial;\n  if (typeof initial === 'function') {\n    initialValue = initial();\n  }\n  if (Object(initialValue) === initialValue && initialValue[SelfMethodsID]) {\n    throw new StateInvalidUsageError(RootPath, ErrorId.InitStateToValueFromState);\n  }\n  return new Store(initialValue);\n}\nvar configuration = {\n  interceptDependencyListsMode: 'always',\n  isDevelopmentMode: typeof process === 'object' && typeof process.env === 'object' && process.env.NODE_ENV === 'development',\n  promiseDetector: function (p) {\n    return Promise.resolve(p) === p;\n  },\n  hiddenInterceptDependencyListsModeDebug: false\n};\n/**\n * Configures Hookstate behavior globally. This is for special cases only, when default\n * heuristics fail to work in a specific environment.\n *\n * @param config\n */\nfunction configure(config) {\n  var _a, _b, _c;\n  configuration = {\n    interceptDependencyListsMode: (_a = config.interceptDependencyListsMode) !== null && _a !== void 0 ? _a : configuration.interceptDependencyListsMode,\n    isDevelopmentMode: (_b = config.isDevelopmentMode) !== null && _b !== void 0 ? _b : configuration.isDevelopmentMode,\n    promiseDetector: (_c = config.promiseDetector) !== null && _c !== void 0 ? _c : configuration.promiseDetector,\n    hiddenInterceptDependencyListsModeDebug: false\n  };\n  interceptReactHooks(); // not really required, but for safety\n  if (configuration.interceptDependencyListsMode === 'never') {\n    configuration.hiddenInterceptDependencyListsModeDebug = false;\n    React['useEffect'] = React['useEffect'] && useEffectOrigin;\n    React['useLayoutEffect'] = React['useLayoutEffect'] && useLayoutEffectOrigin;\n    React['useInsertionEffect'] = React['useInsertionEffect'] && useInsertionEffectOrigin;\n    React['useImperativeHandle'] = React['useImperativeHandle'] && useImperativeHandleOrigin;\n    React['useMemo'] = React['useMemo'] && useMemoOrigin;\n    React['useCallback'] = React['useCallback'] && useCallbackOrigin;\n    // the following does not make an effect as memo calls happen on module load\n    // so it is always set to memoIntercept\n    React['memo'] = React['memo'] && memoOrigin;\n  } else {\n    // do not intercept if a hook is not defined in React\n    // otherwise, it will enable 3rd party libs thinking the react runs at version 18\n    React['useEffect'] = React['useEffect'] && useEffectIntercept;\n    React['useLayoutEffect'] = React['useLayoutEffect'] && useLayoutEffectIntercept;\n    React['useInsertionEffect'] = React['useLayoutEffect'] && useInsertionEffectIntercept;\n    React['useImperativeHandle'] = React['useImperativeHandle'] && useImperativeHandleIntercept;\n    React['useMemo'] = React['useMemo'] && useMemoIntercept;\n    React['useCallback'] = React['useCallback'] && useCallbackIntercept;\n    // the following does not make an effect as memo calls happen on module load\n    // so it is always set to memoIntercept\n    React['memo'] = React['memo'] && memoIntercept;\n    if (configuration.interceptDependencyListsMode === 'development' && configuration.isDevelopmentMode) {\n      configuration.hiddenInterceptDependencyListsModeDebug = true;\n    }\n  }\n}\nfunction reconnectDependencies(deps, fromIntercept) {\n  for (var _i = 0, _a = deps || []; _i < _a.length; _i++) {\n    var i = _a[_i];\n    if (i === Object(i)) {\n      var state = i[self];\n      if (state) {\n        if (fromIntercept && configuration.hiddenInterceptDependencyListsModeDebug) {\n          throw new StateInvalidUsageError(state.path, ErrorId.StateUsedInDependencyList);\n        }\n        state.reconnect();\n      }\n    }\n  }\n  return deps;\n}\nvar useEffectOrigin;\nfunction useHookstateEffect(effect, deps) {\n  reconnectDependencies(deps);\n  return useEffectOrigin(effect, deps);\n}\nfunction useEffectIntercept(effect, deps) {\n  reconnectDependencies(deps, true);\n  return useEffectOrigin(effect, deps);\n}\nvar useLayoutEffectOrigin;\nfunction useHookstateLayoutEffect(effect, deps) {\n  reconnectDependencies(deps);\n  return useLayoutEffectOrigin(effect, deps);\n}\nfunction useLayoutEffectIntercept(effect, deps) {\n  reconnectDependencies(deps, true);\n  return useLayoutEffectOrigin(effect, deps);\n}\nvar useInsertionEffectOrigin;\nfunction useHookstateInsertionEffect(effect, deps) {\n  reconnectDependencies(deps);\n  return useInsertionEffectOrigin(effect, deps);\n}\nfunction useInsertionEffectIntercept(effect, deps) {\n  reconnectDependencies(deps, true);\n  return useInsertionEffectOrigin(effect, deps);\n}\nvar useImperativeHandleOrigin;\nfunction useHookstateImperativeHandle(ref, init, deps) {\n  reconnectDependencies(deps);\n  return useImperativeHandleOrigin(ref, init, deps);\n}\nfunction useImperativeHandleIntercept(ref, init, deps) {\n  reconnectDependencies(deps, true);\n  return useImperativeHandleOrigin(ref, init, deps);\n}\nvar useMemoOrigin;\nfunction useHookstateMemo(factory, deps) {\n  reconnectDependencies(deps);\n  return useMemoOrigin(factory, deps);\n}\nfunction useMemoIntercept(factory, deps) {\n  reconnectDependencies(deps, true);\n  return useMemoOrigin(factory, deps);\n}\nvar useCallbackOrigin;\nfunction useHookstateCallback(callback, deps) {\n  reconnectDependencies(deps);\n  return useCallbackOrigin(callback, deps);\n}\nfunction useCallbackIntercept(callback, deps) {\n  reconnectDependencies(deps, true);\n  return useCallbackOrigin(callback, deps);\n}\nvar memoOrigin;\nfunction hookstateMemo(Component, propsAreEqual) {\n  return memoOrigin(Component, function (prevProps, nextProps) {\n    reconnectDependencies(Object.keys(nextProps).map(function (i) {\n      return nextProps[i];\n    }));\n    return (propsAreEqual || shallowEqual)(prevProps, nextProps);\n  });\n}\nfunction memoIntercept(Component, propsAreEqual) {\n  return memoOrigin(Component, function (prevProps, nextProps) {\n    reconnectDependencies(Object.keys(nextProps).map(function (i) {\n      return nextProps[i];\n    }), true);\n    return (propsAreEqual || shallowEqual)(prevProps, nextProps);\n  });\n}\nfunction interceptReactHooks() {\n  if (!useEffectOrigin && React['useEffect']) {\n    useEffectOrigin = React['useEffect'];\n    React['useEffect'] = useEffectIntercept;\n  }\n  if (!useLayoutEffectOrigin && React['useLayoutEffect']) {\n    useLayoutEffectOrigin = React['useLayoutEffect'];\n    React['useLayoutEffect'] = useLayoutEffectIntercept;\n  }\n  if (!useInsertionEffectOrigin && React['useInsertionEffect']) {\n    useInsertionEffectOrigin = React['useInsertionEffect'];\n    React['useInsertionEffect'] = useInsertionEffectIntercept;\n  }\n  if (!useImperativeHandleOrigin && React['useImperativeHandle']) {\n    useImperativeHandleOrigin = React['useImperativeHandle'];\n    React['useImperativeHandle'] = useImperativeHandleIntercept;\n  }\n  if (!useMemoOrigin && React['useMemo']) {\n    useMemoOrigin = React['useMemo'];\n    React['useMemo'] = useMemoIntercept;\n  }\n  if (!useCallbackOrigin && React['useCallback']) {\n    useCallbackOrigin = React['useCallback'];\n    React['useCallback'] = useCallbackIntercept;\n  }\n  if (!memoOrigin && React['memo']) {\n    memoOrigin = React['memo'];\n    React['memo'] = memoIntercept;\n  }\n}\ninterceptReactHooks(); // TODO defer invoking it until state is created, so the configure had a chance to set it up first\n// Do not try to use useLayoutEffect if DOM not available (SSR)\nvar useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffectOrigin : useEffectOrigin;\nexport { StateFragment, __state, configure, destroy, extend, hookstate, hookstateMemo, isHookstate, isHookstateValue, none, suspend, useHookstate, useHookstateCallback, useHookstateEffect, useHookstateImperativeHandle, useHookstateInsertionEffect, useHookstateLayoutEffect, useHookstateMemo };","map":{"version":3,"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","is","x","y","shallowEqual","objA","objB","keysA","keys","keysB","none","Symbol","__state","hookstate","initial","extension","store","createStore","activate","methods","toMethods","self","destroy","state","deactivate","isHookstate","v","isHookstateValue","SelfMethodsID","extend","e1","e2","e3","e4","e5","extended","extensions","exts","map","onInitCbs","onInit","filter","onPremergeCbs","onPremerge","onPresetCbs","onPreset","onSetCbs","onSet","onDestroyCbs","onDestroy","result","onCreate","instanceFactory","combinedMethods","_i","exts_1","ext","extMethods","e","onInitCbs_1","cb","r","onPremergeCbs_1","onPresetCbs_1","onSetCbs_1","onDestroyCbs_1","useHookstate","source","parentMethods","undefined","isMounted","initializer","onSetUsedCallback","setValue_1","value_1","StateMethodsImpl","path","get","edition","_a","React","useState","StateInvalidUsageError","ErrorId","InitStateStoreSwitchover","defineProperty","enumerable","reconstruct","subscribe","useIsomorphicLayoutEffect","onMount","onUnmount","unsubscribe","setValue_2","value_2","RootPath","_b","ind","nested","setValue_3","_c","value_3","StateFragment","props","scoped","suspend","children","promise","createElement","lazy","_super","id","details","concat","join","Error","Store","_value","_this","_subscribers","Set","configuration","promiseDetector","setPromised","onSetUsedStoreStateMethods","_stateMethods","IsUnmounted","_promiseError","_promiseResolver","_promise","Promise","resolve","then","update","set","catch","err","ad","extensionFactory","_extension","_extensionMethods","_d","forEach","value","SetStateWhenDestroyed","SetStateWhenPromised","prevValue","afterSet","resolver","SetStateNestedToPromised","target","isArray","splice","slice","actions","preset","premerge","values","findIndex","key","a","l","add","delete","toJSON","ToJson_Value","UnusedValue","valueSource","valueEdition","onSetUsed","valueUsed","reset","selfUsed","childrenCreated","childrenUsedPrevious","valueUsedNoProxyPrevious","valueUsedNoProxy","childrenUsed","reconnect","__internalAllowPromised","noproxy","getUntracked","promiseError","GetStateWhenPromised","options","stealth","valueArrayImpl","name","valueObjectImpl","setUntrackedV4","newValue","SetStateToValueFromState","mergeUntracked","sourceValue","mergeUntrackedV4","currentValue","ad_1","push","ad_2","deletedIndexes_1","Number","sort","index","newPropValue","reverse","ad_3","merge","child","rerender","paths","paths_1","subscribers","isAffected","nextChildKey","includes","firstDeletedIndex","find","childKey","nextChild","updated","isInteger","cachedChild","GetProperty_Function","proxyWrap","SetProperty_Value","getter","_","ToJson_State","nestedGetter","prop","toString","ornull","promised","error","opts","SetProperty_State","targetBootstrap","targetGetter","propertyGetter","propertySetter","isValueProxy","onInvalidUsage","op","Proxy","getPrototypeOf","_target","targetReal","SetPrototypeOf_State","SetPrototypeOf_Value","isExtensible","preventExtensions","PreventExtensions_State","PreventExtensions_Value","getOwnPropertyDescriptor","origin_1","configurable","has","deleteProperty","DeleteProperty_State","DeleteProperty_Value","attributes","DefineProperty_State","DefineProperty_Value","ownKeys","writable","getOwnPropertyNames","thisArg","argArray","Apply_State","Apply_Value","construct","newTarget","Construct_State","Construct_Value","initialValue","InitStateToValueFromState","interceptDependencyListsMode","isDevelopmentMode","process","env","NODE_ENV","hiddenInterceptDependencyListsModeDebug","configure","config","interceptReactHooks","useEffectOrigin","useLayoutEffectOrigin","useInsertionEffectOrigin","useImperativeHandleOrigin","useMemoOrigin","useCallbackOrigin","memoOrigin","useEffectIntercept","useLayoutEffectIntercept","useInsertionEffectIntercept","useImperativeHandleIntercept","useMemoIntercept","useCallbackIntercept","memoIntercept","reconnectDependencies","deps","fromIntercept","StateUsedInDependencyList","useHookstateEffect","effect","useHookstateLayoutEffect","useHookstateInsertionEffect","useHookstateImperativeHandle","ref","init","useHookstateMemo","factory","useHookstateCallback","callback","hookstateMemo","Component","propsAreEqual","prevProps","nextProps","window"],"sources":["/home/mergestack/todoapp/node_modules/@hookstate/node_modules/.pnpm/tslib@2.4.0/node_modules/tslib/tslib.es6.js","/home/mergestack/todoapp/node_modules/@hookstate/core/src/is-shallow-equal.ts","/home/mergestack/todoapp/node_modules/@hookstate/core/src/index.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","/**\r\n * Copied from fbjs is-shallow-equal\r\n */\r\n\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\r\n\r\n/**\r\n * inlined Object.is polyfill to avoid requiring consumers ship their own\r\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is\r\n */\r\nfunction is(x: any, y: any): boolean {\r\n    // SameValue algorithm\r\n    if (x === y) { // Steps 1-5, 7-10\r\n        // Steps 6.b-6.e: +0 != -0\r\n        // Added the nonzero y check to make Flow happy, but it is redundant\r\n        return x !== 0 || y !== 0 || 1 / x === 1 / y;\r\n    } else {\r\n        // Step 6.a: NaN == NaN\r\n        return x !== x && y !== y;\r\n    }\r\n}\r\n\r\n/**\r\n * Performs equality by iterating through keys on an object and returning false\r\n * when any key has values which are not strictly equal between the arguments.\r\n * Returns true when the values of all keys are strictly equal.\r\n */\r\nexport function shallowEqual(objA: any, objB: any): boolean {\r\n    if (is(objA, objB)) {\r\n        return true;\r\n    }\r\n\r\n    if (typeof objA !== 'object' || objA === null ||\r\n        typeof objB !== 'object' || objB === null) {\r\n        return false;\r\n    }\r\n\r\n    const keysA = Object.keys(objA);\r\n    const keysB = Object.keys(objB);\r\n\r\n    if (keysA.length !== keysB.length) {\r\n        return false;\r\n    }\r\n\r\n    // Test for A's keys different from B.\r\n    for (let i = 0; i < keysA.length; i++) {\r\n        if (\r\n            !hasOwnProperty.call(objB, keysA[i]) ||\r\n            !is(objA[keysA[i]], objB[keysA[i]])\r\n        ) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}","import React from 'react';\r\nimport { shallowEqual } from './is-shallow-equal';\r\n\r\n///\r\n/// EXPORTED SYMBOLS (LIBRARY INTERFACE)\r\n///\r\n\r\n/**\r\n * 'JSON path' from root of a state object to a nested property.\r\n * Return type of [StateMethod.path](#readonly-path).\r\n *\r\n * For example, an object `{ a: [{ b: 1 }, { 1000: 'value' }, '3rd'] }`,\r\n * has got the following paths pointing to existing properties:\r\n *\r\n * - `[]`\r\n * - `['a']`\r\n * - `['a', 0]`\r\n * - `['a', 0, 'b']`\r\n * - `['a', 1]`\r\n * - `['a', 1, 1000]`\r\n * - `['a', 2]`\r\n */\r\nexport type Path = ReadonlyArray<string | number>;\r\n\r\n/**\r\n * Type of an argument of [State.set](#set).\r\n * \r\n * @typeparam S Type of a value of a state\r\n */\r\nexport type SetStateAction<S> = (S | Immutable<S> | Promise<S | Immutable<S>>) | ((prevState: S) => (S | Immutable<S> | Promise<S | Immutable<S>>));\r\n\r\n/**\r\n * Type of an argument of [State.merge](#merge).\r\n * \r\n * @typeparam S Type of a value of a state\r\n */\r\nexport type SetPartialStateAction<S> =\r\n    S extends ReadonlyArray<(infer U)> ?\r\n    ReadonlyArray<U | Immutable<U>> | Record<number, U | Immutable<U>> | ((prevValue: S) => (ReadonlyArray<U | Immutable<U>> | Record<number, U | Immutable<U>>)) :\r\n    S extends object | string ? Partial<S | Immutable<S>> | ((prevValue: S) => Partial<S | Immutable<S>>) :\r\n    S | Immutable<S> | ((prevState: S) => (S | Immutable<S>));\r\n\r\n/**\r\n * Type of an argument of [hookstate](#hookstate) and [useHookstate](#useHookstate).\r\n * \r\n * @typeparam S Type of a value of a state\r\n */\r\nexport type SetInitialStateAction<S> = S | Promise<S> | (() => S | Promise<S>)\r\n\r\n/**\r\n * Special symbol which might be used to delete properties\r\n * from an object calling [State.set](#set) or [State.merge](#merge).\r\n * \r\n * [Learn more...](https://hookstate.js.org/docs/nested-state#deleting-existing-element)\r\n */\r\nexport const none = Symbol('none') as StateValueAtPath;\r\n\r\n/**\r\n * Return type of [State.keys](#readonly-keys).\r\n * \r\n * @typeparam S Type of a value of a state\r\n */\r\nexport type InferStateKeysType<S> =\r\n    S extends ReadonlyArray<infer _> ? ReadonlyArray<number> :\r\n    S extends null ? undefined :\r\n    S extends object ? ReadonlyArray<string> :\r\n    undefined;\r\n\r\n/**\r\n * Return type of [State.ornull](#ornull).\r\n * \r\n * @typeparam S Type of a value of a state\r\n */\r\nexport type InferStateOrnullType<S, E> =\r\n    S extends undefined ? undefined :\r\n    S extends null ? null : State<S, E>;\r\n\r\n/**\r\n * Makes a value deep readonly\r\n */\r\nexport type Immutable<T> =\r\n    T extends ImmutablePrimitive ? T :\r\n    T extends Array<infer U> ? ImmutableArray<U> :\r\n    T extends Map<infer K, infer V> ? ImmutableMap<K, V> :\r\n    T extends Set<infer M> ? ImmutableSet<M> : ImmutableObject<T>;\r\nexport type ImmutablePrimitive = undefined | null | boolean | string | number | Function;\r\nexport type ImmutableArray<T> = ReadonlyArray<Immutable<T>>;\r\nexport type ImmutableMap<K, V> = ReadonlyMap<Immutable<K>, Immutable<V>>;\r\nexport type ImmutableSet<T> = ReadonlySet<Immutable<T>>;\r\nexport type ImmutableObject<T> = { readonly [K in keyof T]: Immutable<T[K]> };\r\n\r\n/**\r\n * An interface to manage a state in Hookstate.\r\n * \r\n * @typeparam S Type of a value of a state\r\n */\r\nexport interface StateMethods<S, E> {\r\n    /**\r\n     * 'Javascript' object 'path' to an element relative to the root object\r\n     * in the state. For example:\r\n     *\r\n     * ```tsx\r\n     * const state = useHookstate([{ name: 'First Task' }])\r\n     * state.path IS []\r\n     * state[0].path IS [0]\r\n     * state.[0].name.path IS [0, 'name']\r\n     * ```\r\n     */\r\n    readonly path: Path;\r\n\r\n    /**\r\n     * Return the keys of nested states.\r\n     * For a given state of [State](#state) type,\r\n     * `state.keys` will be structurally equal to Object.keys(state),\r\n     * with two minor difference:\r\n     * 1. if `state.value` is an array, the returned result will be\r\n     * an array of numbers, not strings like with `Object.keys`.\r\n     * 2. if `state.value` is not an object, the returned result will be undefined.\r\n     */\r\n    readonly keys: InferStateKeysType<S>;\r\n\r\n    /**\r\n     * Unwraps and returns the underlying state value referred by\r\n     * [path](#readonly-path) of this state instance.\r\n     *\r\n     * It returns the same result as [State.get](#get) method.\r\n     *\r\n     * This property is more useful than [get](#get) method for the cases,\r\n     * when a value may hold null or undefined values.\r\n     * Typescript compiler does not handle elimination of undefined with get(),\r\n     * like in the following examples, but value does:\r\n     *\r\n     * ```tsx\r\n     * const state = useHookstate<number | undefined>(0)\r\n     * const myvalue: number = state.value\r\n     *      ? state.value + 1\r\n     *      : 0; // <-- compiles\r\n     * const myvalue: number = state.get()\r\n     *      ? state.get() + 1\r\n     *      : 0; // <-- does not compile\r\n     * ```\r\n     */\r\n    readonly value: Immutable<S>;\r\n\r\n    /**\r\n     * True if state value is not yet available (eg. equal to a promise)\r\n     */\r\n    readonly promised: boolean;\r\n\r\n    /**\r\n     * If the State is promised, this will be a defined promise\r\n     * which an application can use to subscribe to with 'then' callback.\r\n     */\r\n    readonly promise: Promise<State<S, E>> | undefined;\r\n\r\n    /**\r\n     * If a state was set to a promise and the promise was rejected,\r\n     * this property will return the error captured from the promise rejection\r\n     */\r\n    readonly error: StateErrorAtRoot | undefined;\r\n\r\n    /**\r\n     * Unwraps and returns the underlying state value referred by\r\n     * [path](#readonly-path) of this state instance.\r\n     *\r\n     * It returns the same result as [State.value](#readonly-value) method.\r\n     * \r\n     * If the additional option `noproxy` is set, the method will return\r\n     * the original data object without wrapping it by proxy.\r\n     * All properties of the object will be marked as used and on change will trigger the rerender.\r\n     * \r\n     * If the additional option `stealth` is set, the method will not mark\r\n     * the object as used and it will not trigger the rerender if it is changed.\r\n     * It might be helpful to use it during debugging, for example:\r\n     * `console.log(state.get({ stealth: true }))`.\r\n     * If you use it, make sure you know what you are doing. \r\n     */\r\n    get(options?: { noproxy?: boolean, stealth?: boolean }): Immutable<S>;\r\n\r\n    /**\r\n     * Sets new value for a state.\r\n     * If `this.path === []`,\r\n     * it is similar to the `setState` variable returned by `React.useState` hook.\r\n     * If `this.path !== []`, it sets only the segment of the state value, pointed out by the path.\r\n     * Unlike [merge](#merge) method, this method will not accept partial updates.\r\n     * Partial updates can be also done by walking the nested states and setting those.\r\n     *\r\n     * @param newValue new value to set to a state.\r\n     * It can be a value, a promise resolving to a value\r\n     * (only if [this.path](#readonly-path) is `[]`),\r\n     * or a function returning one of these.\r\n     * The function receives the current state value as an argument.\r\n     */\r\n    set(newValue: SetStateAction<S>): void;\r\n\r\n    /**\r\n     * Similarly to [set](#set) method updates state value.\r\n     *\r\n     * - If current state value is an object, it does partial update for the object.\r\n     * - If state value is an array and the argument is an array too,\r\n     * it concatenates the current value with the value of the argument and sets it to the state.\r\n     * - If state value is an array and the `merge` argument is an object,\r\n     * it does partial update for the current array value.\r\n     * - If current state value is a string, it concatenates the current state\r\n     * value with the argument converted to string and sets the result to the state.\r\n     */\r\n    merge(newValue: SetPartialStateAction<S>): void;\r\n\r\n    /**\r\n     * Returns nested state by key.\r\n     * `state.nested('myprop')` returns the same as `state.myprop` or `state['myprop']`,\r\n     * but also works for properties, which names collide with names of state methods.\r\n     * \r\n     * [Learn more about nested states...](https://hookstate.js.org/docs/nested-state)\r\n     * \r\n     * @param key child property name or index\r\n     */\r\n    nested<K extends keyof S>(key: K): State<S[K], E>;\r\n\r\n    /**\r\n     * If state value is null or undefined, returns state value.\r\n     * Otherwise, it returns this state instance but\r\n     * with null and undefined removed from the type parameter.\r\n     * \r\n     * [Learn more...](https://hookstate.js.org/docs/nullable-state)\r\n     */\r\n    ornull: InferStateOrnullType<S, E>;\r\n}\r\n\r\n/**\r\n * Returns an interface stripped of all keys that don't resolve to U, defaulting \r\n * to a non-strict comparison of T[key] extends U. Setting B to true performs\r\n * a strict type comparison of T[key] extends U & U extends T[key]\r\n */\r\nexport type InferKeysOfType<T, U, B = false> = {\r\n    [P in keyof T]: B extends true\r\n    ? T[P] extends U\r\n    ? (U extends T[P]\r\n        ? P\r\n        : never)\r\n    : never\r\n    : T[P] extends U\r\n    ? P\r\n    : never;\r\n}[keyof T];\r\n\r\n// type PickByType<T, U, B = false> = Pick<T, KeysOfType<T, U, B>>;\r\n\r\n/**\r\n * A symbol which is used for type inference marking.\r\n * \r\n * @hidden\r\n * @ignore\r\n */\r\nexport const __state = Symbol('__state')\r\n/**\r\n * An interface which is used for type inference marking.\r\n * \r\n * @hidden\r\n * @ignore\r\n */\r\nexport interface __State<S, E> {\r\n    [__state]: [S, E]\r\n}\r\n\r\n/**\r\n * A routine which allows to extract value type of a state. Useful for extension developers.\r\n */\r\nexport type InferStateValueType<V> = InferReturnType<V> extends __State<(infer S), (infer _)> ? S : V\r\n/**\r\n * A routine which allows to extract extension methods / properties type of a state.\r\n * Useful for extension developers.\r\n */\r\nexport type InferStateExtensionType<V> = InferReturnType<V> extends __State<(infer _), (infer E)>\r\n    ? E\r\n    : InferReturnType<V> extends Extension<(infer _), (infer _), (infer E)>\r\n    ? E : V\r\nexport type InferReturnType<V> = V extends (...args: any) => (infer R) ? InferReturnType<R> : V;\r\n\r\n/**\r\n * Type of a result of [hookstate](#hookstate) and [useHookstate](#useHookstate) functions\r\n * \r\n * @typeparam S Type of a value of a state\r\n * \r\n * [Learn more about global states...](https://hookstate.js.org/docs/global-state)\r\n * [Learn more about local states...](https://hookstate.js.org/docs/local-state)\r\n * [Learn more about nested states...](https://hookstate.js.org/docs/nested-state)\r\n */\r\nexport type State<S, E = {}> = __State<S, E> & StateMethods<S, E> & E & (\r\n    S extends ReadonlyArray<(infer U)> ? ReadonlyArray<State<U, E>> :\r\n    S extends object ? Omit<\r\n        { readonly [K in keyof Required<S>]: State<S[K], E>; },\r\n        keyof StateMethods<S, E> | InferKeysOfType<S, Function> | keyof E\r\n    > : {}\r\n);\r\n\r\n/**\r\n * For extension developers only.\r\n * Type alias to highlight the places where we are dealing with root state value.\r\n *\r\n * @hidden\r\n * @ignore\r\n */\r\nexport type StateValueAtRoot = any; //tslint:disable-line: no-any\r\n/**\r\n * For extension developers only.\r\n * Type alias to highlight the places where we are dealing with nested state value.\r\n *\r\n * @hidden\r\n * @ignore\r\n */\r\nexport type StateValueAtPath = any; //tslint:disable-line: no-any\r\n/**\r\n * For extension developers only.\r\n * Type alias to highlight the places where we are dealing with state error.\r\n *\r\n * @hidden\r\n * @ignore\r\n */\r\nexport type StateErrorAtRoot = any; //tslint:disable-line: no-any\r\n\r\n/**\r\n * For extension developers only.\r\n * Type alias to highlight the places where we are dealing with unknown state extension type.\r\n *\r\n * @hidden\r\n * @ignore\r\n */\r\nexport type StateExtensionUnknown = any; //tslint:disable-line: no-any\r\n\r\n/**\r\n * For extension developers only.\r\n * An additional descriptor of an action mutation action applied\r\n * \r\n * @hidden\r\n * @ignore\r\n */\r\nexport interface SetActionDescriptor {\r\n    // path to update / rerender,\r\n    // migth be not the same as the part of state methods\r\n    // for example, when a new index is added to array\r\n    path: Path,\r\n    actions?: Record<string | number, \"I\" | \"U\" | \"D\">\r\n}\r\n\r\n/**\r\n * For extension developers only.\r\n * Set of callbacks, an extension may subscribe to.\r\n * \r\n * [Learn more...](https://hookstate.js.org/docs/writing-extension)\r\n */\r\nexport interface Extension<S, I, E> {\r\n    readonly onCreate?: (\r\n        state: State<S, {}>,\r\n        extensionsCallbacks: {\r\n            [K in keyof I]: (i: State<StateValueAtPath, E & I>) => I[K];\r\n        },\r\n    ) => { readonly [K in keyof Required<E>]: (state: State<StateValueAtPath, E & I>) => E[K]; },\r\n    readonly onInit?: (\r\n        state: State<S, E & I>,\r\n        extensionsCallbacks: {\r\n            [K in keyof E & I]: (i: State<StateValueAtPath, E & I>) => (E & I)[K];\r\n        }\r\n    ) => void,\r\n    readonly onPreset?: (state: State<StateValueAtPath, E & I>, value: StateValueAtPath, rootState: State<StateValueAtRoot, E & I>) => void,\r\n    readonly onPremerge?: (state: State<StateValueAtPath, E & I>, value: StateValueAtPath, rootState: State<StateValueAtRoot, E & I>) => void,\r\n    readonly onSet?: (state: State<StateValueAtPath, E & I>, descriptor: SetActionDescriptor, rootState: State<StateValueAtRoot, E & I>) => void,\r\n    readonly onDestroy?: (state: State<S, E & I>) => void,\r\n};\r\n\r\nexport type ExtensionFactory<S, I, E> = (typemarker?: __State<S, I>) => Extension<S, I, E>\r\n\r\nexport function hookstate<S, E = {}>(\r\n    source: __State<S, E>,\r\n    extension?: ExtensionFactory<S, E, StateExtensionUnknown>\r\n): never;\r\n/**\r\n * Creates new state and returns it.\r\n *\r\n * You can create as many global states as you need.\r\n *\r\n * When you the state is not needed anymore,\r\n * it should be destroyed by calling\r\n * `destroy()` function.\r\n * This is necessary for some extensions,\r\n * which allocate native resources,\r\n * like subscription to databases, broadcast channels, etc.\r\n * In most cases, a global state is used during\r\n * whole life time of an application and would not require\r\n * destruction. However, if you have got, for example,\r\n * a catalog of dynamically created and destroyed global states,\r\n * the states should be destroyed as advised above.\r\n *\r\n * @param initial Initial value of the state.\r\n * It can be a value OR a promise,\r\n * which asynchronously resolves to a value,\r\n * OR a function returning a value or a promise.\r\n *\r\n * @typeparam S Type of a value of the state\r\n *\r\n * @returns [State](#state) instance,\r\n * which can be used directly to get and set state value\r\n * outside of React components.\r\n * When you need to use the state in a functional `React` component,\r\n * pass the created state to [useHookstate](#useHookstate) function and\r\n * use the returned result in the component's logic.\r\n */\r\nexport function hookstate<S, E extends {} = {}>(\r\n    initial: SetInitialStateAction<S>,\r\n    extension?: ExtensionFactory<S, {}, E>\r\n): State<S, E>;\r\nexport function hookstate<S, E extends {} = {}>(\r\n    initial: SetInitialStateAction<S>,\r\n    extension?: ExtensionFactory<S, {}, E>\r\n): State<S, E> {\r\n    const store = createStore(initial);\r\n    store.activate(extension as ExtensionFactory<StateValueAtRoot, {}, StateExtensionUnknown>)\r\n    const methods = store.toMethods();\r\n    return methods.self() as unknown as State<S, E>;\r\n}\r\n\r\n/**\r\n * A method to destroy a global state and resources allocated by the extensions\r\n */\r\nexport function destroy<S, E>(state: __State<S, E>) {\r\n    (state[self] as StateMethodsImpl<S, E>).deactivate()\r\n}\r\n\r\n/**\r\n * A method to check if a variable is an instance of Hookstate State\r\n */\r\nexport function isHookstate(v: any) {\r\n    return !!(v?.[self])\r\n}\r\n\r\n/**\r\n * A method to check if a variable is an instance of traced (wrapped in a proxy) Hookstate Value\r\n */\r\nexport function isHookstateValue(v: any) {\r\n    return !!(v?.[SelfMethodsID])\r\n}\r\n\r\n/**\r\n * A function combines multiple extensions into one extension and returns it\r\n * Browse an example [here](https://hookstate.js.org/docs/extensions-snapshotable)\r\n */\r\nexport function extend<\r\n    S,\r\n    E,\r\n    E1 extends {} = {},\r\n    E2 extends {} = {},\r\n    E3 extends {} = {},\r\n    E4 extends {} = {},\r\n    E5 extends {} = {}\r\n>(\r\n    e1?: ExtensionFactory<S, E, E1>,\r\n    e2?: ExtensionFactory<S, E1 & E, E2>,\r\n    e3?: ExtensionFactory<S, E2 & E1 & E, E3>,\r\n    e4?: ExtensionFactory<S, E3 & E2 & E1 & E, E4>,\r\n    e5?: ExtensionFactory<S, E4 & E3 & E2 & E1 & E, E5>\r\n): ExtensionFactory<S, E, E5 & E4 & E3 & E2 & E1> {\r\n    function extended(extensions: (ExtensionFactory<S, E, {}>)[]) {\r\n        let exts = extensions.map(i => i());\r\n        let onInitCbs = exts.map(i => i.onInit).filter(i => i)\r\n        let onPremergeCbs = exts.map(i => i.onPremerge).filter(i => i)\r\n        let onPresetCbs = exts.map(i => i.onPreset).filter(i => i)\r\n        let onSetCbs = exts.map(i => i.onSet).filter(i => i)\r\n        let onDestroyCbs = exts.map(i => i.onDestroy).filter(i => i)\r\n        let result: Writeable<Extension<S, E, {}>> = {\r\n            onCreate: (instanceFactory, combinedMethods) => {\r\n                for (let ext of exts) {\r\n                    if (ext.onCreate) {\r\n                        let extMethods = ext.onCreate(instanceFactory, combinedMethods)\r\n                        Object.assign(combinedMethods, extMethods)\r\n                    }\r\n                }\r\n                return combinedMethods\r\n            }\r\n        }\r\n        if (onInitCbs.length > 0) {\r\n            result.onInit = (s, e) => {\r\n                for (let cb of onInitCbs) {\r\n                    cb!(s, e);\r\n                }\r\n            }\r\n        }\r\n        if (onPremergeCbs.length > 0) {\r\n            result.onPremerge = (s, d, r) => {\r\n                for (let cb of onPremergeCbs) {\r\n                    cb!(s, d, r);\r\n                }\r\n            }\r\n        }\r\n        if (onPresetCbs.length > 0) {\r\n            result.onPreset = (s, d, r) => {\r\n                for (let cb of onPresetCbs) {\r\n                    cb!(s, d, r);\r\n                }\r\n            }\r\n        }\r\n        if (onSetCbs.length > 0) {\r\n            result.onSet = (s, d, r) => {\r\n                for (let cb of onSetCbs) {\r\n                    cb!(s, d, r);\r\n                }\r\n            }\r\n        }\r\n        if (onDestroyCbs.length > 0) {\r\n            result.onDestroy = (s) => {\r\n                for (let cb of onDestroyCbs) {\r\n                    cb!(s);\r\n                }\r\n            }\r\n        }\r\n        return result as Extension<S, E, E1 & E2 & E3 & E4 & E5>\r\n    }\r\n    return () => extended((\r\n        [e1, e2, e3, e4, e5] as ExtensionFactory<S, E, {}>[]\r\n    ).filter(i => i!))\r\n}\r\n\r\n/**\r\n * @warning Initializing a local state to a promise without using \r\n * an initializer callback function, which returns a Promise,\r\n * is almost always a mistake. So, it is blocked.\r\n * Use `useHookstate(() => your_promise)` instead of `useHookstate(your_promise)`.\r\n */\r\nexport function useHookstate<S, E extends {} = {}>(\r\n    source: Promise<S>,\r\n    extension?: ExtensionFactory<S, {}, E>\r\n): never;\r\nexport function useHookstate<S, E extends {} = {}>(\r\n    source: __State<S, E>,\r\n    extension: ExtensionFactory<S, E, StateExtensionUnknown>\r\n): never;\r\n/**\r\n * Enables a functional React component to use a state,\r\n * either created by [hookstate](#hookstate) (*global* state) or\r\n * derived from another call to [useHookstate](#useHookstate) (*scoped* state).\r\n *\r\n * The `useHookstate` forces a component to rerender every time, when:\r\n * - a segment/part of the state data is updated *AND only if*\r\n * - this segment was **used** by the component during or after the latest rendering.\r\n *\r\n * For example, if the state value is `{ a: 1, b: 2 }` and\r\n * a component uses only `a` property of the state, it will rerender\r\n * only when the whole state object is updated or when `a` property is updated.\r\n * Setting the state value/property to the same value is also considered as an update.\r\n *\r\n * A component can use one or many states,\r\n * i.e. you may call `useHookstate` multiple times for multiple states.\r\n *\r\n * The same state can be used by multiple different components.\r\n *\r\n * @param source a reference to the state to hook into\r\n *\r\n * The `useHookstate` is a hook and should follow React's rules of hooks.\r\n *\r\n * @returns an instance of [State](#state),\r\n * which **must be** used within the component (during rendering\r\n * or in effects) or it's children.\r\n */\r\nexport function useHookstate<S, E extends {} = {}>(\r\n    source: __State<S, E>\r\n): State<S, E>;\r\n/**\r\n * This function enables a functional React component to use a state,\r\n * created per component by [useHookstate](#useHookstate) (*local* state).\r\n * In this case `useHookstate` behaves similarly to `React.useState`,\r\n * but the returned instance of [State](#state)\r\n * has got more features.\r\n *\r\n * When a state is used by only one component, and maybe it's children,\r\n * it is recommended to use *local* state instead of *global*,\r\n * which is created by [hookstate](#hookstate).\r\n *\r\n * *Local* (per component) state is created when a component is mounted\r\n * and automatically destroyed when a component is unmounted.\r\n *\r\n * The same as with the usage of a *global* state,\r\n * `useHookstate` forces a component to rerender when:\r\n * - a segment/part of the state data is updated *AND only if*\r\n * - this segment was **used** by the component during or after the latest rendering.\r\n *\r\n * You can use as many local states within the same component as you need.\r\n *\r\n * @param source An initial value state.\r\n *\r\n * @returns an instance of [State](#state),\r\n * which **must be** used within the component (during rendering\r\n * or in effects) or it's children.\r\n */\r\nexport function useHookstate<S, E extends {} = {}>(\r\n    source: SetInitialStateAction<S>,\r\n    extension?: ExtensionFactory<S, {}, E>\r\n): State<S, E>;\r\nexport function useHookstate<S, E extends {} = {}>(\r\n    source: SetInitialStateAction<S> | State<S, E>,\r\n    extension?: ExtensionFactory<S, {}, E>\r\n): State<S, E> {\r\n    const parentMethods = Object(source) === source ?\r\n        source[self] as StateMethodsImpl<S, E> | undefined :\r\n        undefined;\r\n    if (parentMethods) {\r\n        if (parentMethods.isMounted) {\r\n            // Scoped state mount\r\n            // eslint-disable-next-line react-hooks/rules-of-hooks\r\n            const initializer = () => {\r\n                // warning: this is called twice in react strict mode\r\n                let store = parentMethods.store\r\n                let onSetUsedCallback = () => setValue({\r\n                    store: store, // immutable\r\n                    state: state, // immutable\r\n                    source: value.source // mutable, get the latest from value\r\n                })\r\n                let state = new StateMethodsImpl<S, E>(\r\n                    store,\r\n                    parentMethods.path,\r\n                    store.get(parentMethods.path),\r\n                    store.edition,\r\n                    onSetUsedCallback\r\n                );\r\n                return {\r\n                    store: store,\r\n                    state: state,\r\n                    source: source\r\n                }\r\n            };\r\n            const [value, setValue] = React.useState(initializer);\r\n\r\n            if (value.store !== parentMethods.store || !('source' in value)) {\r\n                throw new StateInvalidUsageError(parentMethods.path, ErrorId.InitStateStoreSwitchover)\r\n            }\r\n\r\n            // TODO move to a class hide props on prototype level\r\n            // hide props from development tools\r\n            Object.defineProperty(value, 'store', { enumerable: false });\r\n            Object.defineProperty(value, 'state', { enumerable: false });\r\n            Object.defineProperty(value, 'source', { enumerable: false });\r\n\r\n            value.state.reconstruct(\r\n                parentMethods.path,\r\n                value.store.get(parentMethods.path),\r\n                value.store.edition,\r\n                // parent state object has changed its reference object\r\n                // so the scopped state should change too\r\n                value.source !== source\r\n            );\r\n            value.source = source;\r\n\r\n            // need to subscribe in sync mode, because\r\n            // safari delays calling the effect giving priority to timeouts and network events,\r\n            // which can cause the state update\r\n            parentMethods.subscribe(value.state); // no-op if already subscribed\r\n            useIsomorphicLayoutEffect(() => {\r\n                // warning: in strict mode, effect is called twice\r\n                // so need to restore subscription and reconstruct the extension\r\n                // after the first effect unmount callback\r\n                value.state.onMount() // no-op if already mounted\r\n                parentMethods.subscribe(value.state); // no-op if already subscribed\r\n                return () => {\r\n                    value.state.onUnmount()\r\n                    parentMethods.unsubscribe(value.state);\r\n                }\r\n            }, []);\r\n\r\n            let state = value.state.self();\r\n            // expose property in development tools\r\n            value['[hookstate(scoped)]'] = state; // TODO use label here, add core extension to label states\r\n            return state\r\n        } else {\r\n            // Global state mount or destroyed link\r\n            // eslint-disable-next-line react-hooks/rules-of-hooks\r\n            let initializer = () => {\r\n                // warning: this is called twice in react strict mode\r\n                let store = parentMethods.store\r\n                let onSetUsedCallback = () => setValue({\r\n                    store: store, // immutable\r\n                    state: state, // immutable\r\n                    source: value.source // mutable, get the latest from value\r\n                })\r\n                let state = new StateMethodsImpl<S, E>(\r\n                    store,\r\n                    RootPath,\r\n                    store.get(RootPath),\r\n                    store.edition,\r\n                    onSetUsedCallback\r\n                );\r\n                return {\r\n                    store: store,\r\n                    state: state,\r\n                    source: source\r\n                }\r\n            }\r\n            const [value, setValue] = React.useState(initializer);\r\n\r\n            if (value.store !== parentMethods.store || !('source' in value)) {\r\n                throw new StateInvalidUsageError(parentMethods.path, ErrorId.InitStateStoreSwitchover)\r\n            }\r\n\r\n            // hide props from development tools\r\n            Object.defineProperty(value, 'store', { enumerable: false });\r\n            Object.defineProperty(value, 'state', { enumerable: false });\r\n            Object.defineProperty(value, 'source', { enumerable: false });\r\n\r\n            value.state.reconstruct(\r\n                RootPath,\r\n                value.store.get(RootPath),\r\n                value.store.edition,\r\n                // parent state object has changed its reference object\r\n                // so the scopped state should change too\r\n                value.source !== source\r\n            );\r\n            value.source = source;\r\n\r\n            // need to subscribe in sync mode, because\r\n            // safari delays calling the effect giving priority to timeouts and network events,\r\n            // which can cause the state update\r\n            value.store.subscribe(value.state); // no-op if already subscribed\r\n            useIsomorphicLayoutEffect(() => {\r\n                // warning: in strict mode, effect is called twice\r\n                // so need to restore subscription and reconstruct the extension\r\n                // after the first effect unmount callback\r\n                value.state.onMount() // no-op if already mounted\r\n                value.store.subscribe(value.state); // no-op if already subscribed\r\n                return () => {\r\n                    value.state.onUnmount()\r\n                    value.store.unsubscribe(value.state);\r\n                }\r\n            }, []);\r\n\r\n            let state: State<StateValueAtPath, E> = value.state.self();\r\n            for (let ind = 0; ind < parentMethods.path.length; ind += 1) {\r\n                state = state.nested(parentMethods.path[ind]);\r\n            }\r\n            // expose property in development tools\r\n            value['[hookstate(global)]'] = state; // TODO use label here, add core extension to label states\r\n            return state as State<S, E>;\r\n        }\r\n    } else {\r\n        // Local state mount\r\n        // eslint-disable-next-line react-hooks/rules-of-hooks\r\n        let initializer = () => {\r\n            // warning: this is called twice in react strict mode\r\n            let store = createStore(source)\r\n            let onSetUsedCallback = () => setValue({\r\n                store: store,\r\n                state: state,\r\n            })\r\n            let state = new StateMethodsImpl<S, E>(\r\n                store,\r\n                RootPath,\r\n                store.get(RootPath),\r\n                store.edition,\r\n                onSetUsedCallback\r\n            );\r\n            return {\r\n                store: store,\r\n                state: state\r\n            }\r\n        }\r\n        const [value, setValue] = React.useState(initializer);\r\n\r\n        if ('source' in value) {\r\n            throw new StateInvalidUsageError(RootPath, ErrorId.InitStateStoreSwitchover)\r\n        }\r\n\r\n        // hide props from development tools\r\n        Object.defineProperty(value, 'store', { enumerable: false });\r\n        Object.defineProperty(value, 'state', { enumerable: false });\r\n\r\n        value.state.reconstruct(\r\n            RootPath,\r\n            value.store.get(RootPath),\r\n            value.store.edition,\r\n            false\r\n        );\r\n\r\n        // need to subscribe in sync mode, because\r\n        // safari delays calling the effect giving priority to timeouts and network events,\r\n        // which can cause the state update\r\n        value.store.subscribe(value.state); // no-op if already subscribed\r\n        // need to attach the extension straight away\r\n        // because extension methods are used in render function\r\n        // and we can not defer it to the effect callback\r\n        value.store.activate(extension as ExtensionFactory<StateValueAtRoot, {}, StateExtensionUnknown>); // no-op if already attached\r\n        useIsomorphicLayoutEffect(() => {\r\n            // warning: in strict mode, effect is called twice\r\n            // so need to restore subscription and reconstruct the extension\r\n            // after the first effect unmount callback\r\n            value.state.onMount() // no-op if already mounted\r\n            value.store.subscribe(value.state); // no-op if already subscribed\r\n            value.store.activate(extension as ExtensionFactory<StateValueAtRoot, {}, StateExtensionUnknown>); // no-op if already attached\r\n            return () => {\r\n                value.state.onUnmount()\r\n                value.store.unsubscribe(value.state);\r\n                value.store.deactivate() // this will destroy the extensions\r\n            }\r\n        }, []);\r\n\r\n        let state = value.state.self();\r\n        // expose property in development tools\r\n        value['[hookstate(local)]'] = state; // TODO use label here, add core extension to label states\r\n        return state\r\n    }\r\n}\r\n\r\nexport function StateFragment<S, E extends {}>(\r\n    props: {\r\n        state: __State<S, E>,\r\n        extension: ExtensionFactory<S, E, StateExtensionUnknown>,\r\n        children: (state: State<S, E>) => React.ReactElement,\r\n        suspend?: boolean,\r\n    }\r\n): never;\r\n/**\r\n * Allows to use a state without defining a functional react component.\r\n * It can be also used in class-based React components. It is also\r\n * particularly useful for creating *scoped* states.\r\n *\r\n * [Learn more...](https://hookstate.js.org/docs/using-without-statehook)\r\n * \r\n * @typeparam S Type of a value of a state\r\n */\r\nexport function StateFragment<S, E extends {}>(\r\n    props: {\r\n        state: __State<S, E>,\r\n        children: (state: State<S, E>) => React.ReactElement,\r\n        suspend?: boolean,\r\n    }\r\n): React.ReactElement;\r\n/**\r\n * Allows to use a state without defining a functional react component.\r\n * See more at [StateFragment](#statefragment)\r\n * \r\n * [Learn more...](https://hookstate.js.org/docs/using-without-statehook)\r\n * \r\n * @typeparam S Type of a value of a state\r\n */\r\nexport function StateFragment<S, E extends {}>(\r\n    props: {\r\n        state: SetInitialStateAction<S>,\r\n        extension?: ExtensionFactory<S, {}, E>,\r\n        children: (state: State<S, E>) => React.ReactElement,\r\n        suspend?: boolean,\r\n    }\r\n): React.ReactElement;\r\nexport function StateFragment<S, E extends {}>(\r\n    props: {\r\n        state: State<S, E> | SetInitialStateAction<S>,\r\n        extension?: ExtensionFactory<S, {}, E>,\r\n        children: (state: State<S, E>) => React.ReactElement,\r\n        suspend?: boolean,\r\n    }\r\n): React.ReactElement {\r\n    const scoped = useHookstate(props.state as SetInitialStateAction<S>, props.extension);\r\n    return props.suspend && suspend(scoped) || props.children(scoped);\r\n}\r\n\r\n/**\r\n * If state is promised, then it returns a component which integrates with React 18 Suspend feature automatically.\r\n * Note, that React 18 Suspend support for data loading is still experimental,\r\n * but it worked as per our experiments and testing.\r\n */\r\nexport function suspend<S, E>(state: State<S, E>) {\r\n    const p = state.promise;\r\n    return p && React.createElement(React.lazy(() => p as Promise<any>));\r\n}\r\n\r\n///\r\n/// INTERNAL SYMBOLS (LIBRARY IMPLEMENTATION)\r\n///\r\n\r\nconst self = Symbol('self')\r\n\r\nenum ErrorId {\r\n    StateUsedInDependencyList = 100,\r\n\r\n    InitStateToValueFromState = 101,\r\n    SetStateToValueFromState = 102,\r\n    GetStateWhenPromised = 103,\r\n    SetStateWhenPromised = 104,\r\n    SetStateNestedToPromised = 105,\r\n    SetStateWhenDestroyed = 106,\r\n    ToJson_Value = 108,\r\n    ToJson_State = 109,\r\n\r\n    GetProperty_Function = 110,\r\n    InitStateStoreSwitchover = 111,\r\n\r\n    GetUnknownPlugin = 120,\r\n\r\n    SetProperty_State = 201,\r\n    SetProperty_Value = 202,\r\n    SetPrototypeOf_State = 203,\r\n    SetPrototypeOf_Value = 204,\r\n    PreventExtensions_State = 205,\r\n    PreventExtensions_Value = 206,\r\n    DefineProperty_State = 207,\r\n    DefineProperty_Value = 208,\r\n    DeleteProperty_State = 209,\r\n    DeleteProperty_Value = 210,\r\n    Construct_State = 211,\r\n    Construct_Value = 212,\r\n    Apply_State = 213,\r\n    Apply_Value = 214,\r\n}\r\n\r\nclass StateInvalidUsageError extends Error {\r\n    constructor(path: Path, id: ErrorId, details?: string) {\r\n        super(`Error: HOOKSTATE-${id} [path: /${path.join('/')}${details ? `, details: ${details}` : ''}]. ` +\r\n            `See https://hookstate.js.org/docs/exceptions#hookstate-${id}`)\r\n    }\r\n}\r\n\r\ninterface Subscriber {\r\n    onSet(paths: SetActionDescriptor, actions: Set<() => void>): boolean;\r\n}\r\n\r\ninterface Subscribable {\r\n    subscribe(l: Subscriber): void;\r\n    unsubscribe(l: Subscriber): void;\r\n}\r\n\r\nconst SelfMethodsID = Symbol('ProxyMarker');\r\n\r\nconst RootPath: Path = [];\r\n\r\ntype Writeable<T> = { -readonly [P in keyof T]: T[P] };\r\n\r\nclass Store implements Subscribable {\r\n    // > 0 means active store, < 0 means destroyed\r\n    // please note, in react strict mode and hot reload cases\r\n    // state can be reused, so we should support store resurection\r\n    public edition = 1;\r\n\r\n    private _stateMethods: StateMethodsImpl<StateValueAtRoot, StateExtensionUnknown>;\r\n\r\n    private _subscribers: Set<Subscriber> = new Set();\r\n\r\n    private _extension?: Extension<StateValueAtRoot, {}, {}>;\r\n    private _extensionMethods?: {};\r\n\r\n    private _promise?: Promise<StateValueAtRoot>;\r\n    private _promiseResolver?: (_: StateValueAtRoot) => void;\r\n    private _promiseError?: StateValueAtRoot;\r\n\r\n    constructor(private _value: StateValueAtRoot) {\r\n        if (Object(_value) === _value &&\r\n            configuration.promiseDetector(_value)) {\r\n            this.setPromised(_value)\r\n        } else if (_value === none) {\r\n            this.setPromised(undefined)\r\n        }\r\n\r\n        let onSetUsedStoreStateMethods = () => {\r\n            this._stateMethods.reconstruct(\r\n                RootPath,\r\n                this.get(RootPath),\r\n                this.edition,\r\n                false\r\n            )\r\n        }\r\n        onSetUsedStoreStateMethods[IsUnmounted] = true\r\n\r\n        this._stateMethods = new StateMethodsImpl<StateValueAtRoot, {}>(\r\n            this,\r\n            RootPath,\r\n            this.get(RootPath),\r\n            this.edition,\r\n            onSetUsedStoreStateMethods\r\n        )\r\n        this.subscribe(this._stateMethods)\r\n    }\r\n\r\n    setPromised(promise: StateValueAtPath | undefined) {\r\n        this._value = none\r\n        this._promiseError = undefined\r\n        this._promiseResolver = undefined\r\n\r\n        if (!promise) {\r\n            this._promise = new Promise<StateValueAtRoot>(resolve => {\r\n                this._promiseResolver = resolve;\r\n            })\r\n            return;\r\n        }\r\n\r\n        promise = promise\r\n            .then((r: StateValueAtRoot) => {\r\n                if (this._promise === promise) {\r\n                    this._promise = undefined\r\n                    this._promiseError = undefined\r\n                    this._promiseResolver === undefined\r\n                    this.update(this._stateMethods.self(), this.set(RootPath, r))\r\n                }\r\n            })\r\n            .catch((err: StateValueAtRoot) => {\r\n                if (this._promise === promise) {\r\n                    this._promise = undefined\r\n                    this._promiseResolver = undefined\r\n                    this._promiseError = err\r\n                    this.edition += 1\r\n                    let ad = { path: RootPath };\r\n                    this.update(this._stateMethods.self(), ad)\r\n                }\r\n            })\r\n        this._promise = promise\r\n    }\r\n\r\n    activate(extensionFactory: ExtensionFactory<StateValueAtRoot, {}, StateExtensionUnknown> | undefined) {\r\n        if (this.edition < 0) {\r\n            this.edition = -this.edition\r\n        }\r\n        if (this._extension === undefined) {\r\n            this._extension = extensionFactory?.();\r\n            this._extensionMethods = this._extension?.onCreate?.(this._stateMethods.self(), {})\r\n            // this is invoked with all extension methods activated on the state\r\n            this._extension?.onInit?.(this._stateMethods.self(), this._extensionMethods || {})\r\n        }\r\n    }\r\n\r\n    deactivate() {\r\n        if (this._extension) {\r\n            this._extension.onDestroy?.(this._stateMethods.self())\r\n            delete this._extension;\r\n            delete this._extensionMethods;\r\n        }\r\n        if (this.edition > 0) {\r\n            this.edition = -this.edition\r\n        }\r\n    }\r\n\r\n    get extension() {\r\n        return this._extensionMethods\r\n    }\r\n\r\n    get promise() {\r\n        return this._promise;\r\n    }\r\n\r\n    get promiseError() {\r\n        return this._promiseError;\r\n    }\r\n\r\n    get(path: Path) {\r\n        let result = this._value;\r\n        if (result === none) {\r\n            return result;\r\n        }\r\n        path.forEach(p => {\r\n            result = result[p];\r\n        });\r\n        return result;\r\n    }\r\n\r\n    set(path: Path, value: StateValueAtPath): SetActionDescriptor {\r\n        if (this.edition < 0) {\r\n            // TODO convert to console log\r\n            throw new StateInvalidUsageError(path, ErrorId.SetStateWhenDestroyed)\r\n        }\r\n\r\n        if (path.length === 0) {\r\n            // Root value UPDATE case,\r\n\r\n            if (value === none) {\r\n                this.setPromised(undefined)\r\n            } else if (Object(value) === value && configuration.promiseDetector(value)) {\r\n                this.setPromised(value)\r\n                value = none\r\n            } else if (this._promise && !this._promiseResolver) {\r\n                throw new StateInvalidUsageError(path, ErrorId.SetStateWhenPromised)\r\n            } else {\r\n                this._promiseError = undefined\r\n            }\r\n\r\n            let prevValue = this._value;\r\n            this._value = value;\r\n            this.afterSet()\r\n\r\n            if (prevValue === none && this._value !== none && this._promiseResolver) {\r\n                this._promise = undefined\r\n                this._promiseError = undefined\r\n                let resolver = this._promiseResolver\r\n                this._promiseResolver === undefined\r\n                resolver(this._value)\r\n            }\r\n\r\n            return {\r\n                path\r\n            };\r\n        }\r\n\r\n        if (Object(value) === value && configuration.promiseDetector(value)) {\r\n            // TODO this one still can get into the state as nested property, need to check on read instead\r\n            throw new StateInvalidUsageError(path, ErrorId.SetStateNestedToPromised)\r\n        }\r\n\r\n        let target = this._value;\r\n        for (let i = 0; i < path.length - 1; i += 1) {\r\n            target = target[path[i]];\r\n        }\r\n\r\n        const p = path[path.length - 1]\r\n        if (p in target) {\r\n            if (value !== none) {\r\n                // Property UPDATE case\r\n                target[p] = value;\r\n                this.afterSet()\r\n                return {\r\n                    path\r\n                };\r\n            } else {\r\n                // Property DELETE case\r\n                if (Array.isArray(target) && typeof p === 'number') {\r\n                    target.splice(p, 1)\r\n                } else {\r\n                    delete target[p]\r\n                }\r\n                this.afterSet()\r\n\r\n                // if an array of objects is about to loose existing property\r\n                // we consider it is the whole object is changed\r\n                // which is identified by upper path\r\n                return {\r\n                    path: path.slice(0, -1),\r\n                    actions: { [p]: \"D\" as \"D\" }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (value !== none) {\r\n            // Property INSERT case\r\n            target[p] = value;\r\n            this.afterSet()\r\n\r\n            // if an array of objects is about to be extended by new property\r\n            // we consider it is the whole object is changed\r\n            // which is identified by upper path\r\n            return {\r\n                path: path.slice(0, -1),\r\n                actions: { [p]: \"I\" as \"I\" }\r\n            }\r\n        }\r\n\r\n        // Non-existing property DELETE case\r\n        // no-op\r\n        return {\r\n            path\r\n        };\r\n    }\r\n\r\n    preset(state: State<StateValueAtPath, StateExtensionUnknown>, value: StateValueAtPath) {\r\n        this._extension?.onPreset?.(state, value, this._stateMethods.self())\r\n    }\r\n\r\n    premerge(state: State<StateValueAtPath, StateExtensionUnknown>, value: StateValueAtPath) {\r\n        this._extension?.onPremerge?.(state, value, this._stateMethods.self())\r\n    }\r\n\r\n    update(state: State<StateValueAtPath, StateExtensionUnknown>, ad: SetActionDescriptor) {\r\n        this._extension?.onSet?.(state, ad, this._stateMethods.self())\r\n\r\n        const actions = new Set<() => void>();\r\n        // check if actions descriptor can be unfolded into a number of individual update actions\r\n        // this is the case when merge call swaps to properties for example\r\n        // so we optimize rerendering only these properties\r\n        if (ad.actions && Object.values(ad.actions).findIndex(i => i !== \"U\") === -1) {\r\n            // all actions are update actions\r\n            Object.keys(ad.actions).forEach(key => {\r\n                this._subscribers.forEach(s => s.onSet({ path: ad.path.concat(key) }, actions));\r\n            })\r\n        } else {\r\n            this._subscribers.forEach(s => s.onSet(ad, actions));\r\n        }\r\n        actions.forEach(a => a());\r\n    }\r\n\r\n    afterSet() {\r\n        if (this.edition > 0) {\r\n            this.edition += 1;\r\n        }\r\n        if (this.edition < 0) {\r\n            this.edition -= 1;\r\n        }\r\n    }\r\n    toMethods() {\r\n        return this._stateMethods;\r\n    }\r\n\r\n    subscribe(l: Subscriber) {\r\n        this._subscribers.add(l);\r\n    }\r\n\r\n    unsubscribe(l: Subscriber) {\r\n        this._subscribers.delete(l);\r\n    }\r\n\r\n    toJSON() {\r\n        throw new StateInvalidUsageError(RootPath, ErrorId.ToJson_Value);\r\n    }\r\n}\r\n\r\n// use symbol property to allow for easier reference finding\r\nconst UnusedValue = Symbol('UnusedValue');\r\n\r\n// use symbol to mark that a function has no effect anymore\r\nconst IsUnmounted = Symbol('IsUnmounted');\r\n\r\nclass StateMethodsImpl<S, E> implements StateMethods<S, E>, Subscribable, Subscriber {\r\n    private subscribers: Set<Subscriber> | undefined;\r\n\r\n    private childrenCreated: Record<string | number, StateMethodsImpl<StateValueAtPath, E>> | undefined;\r\n    private childrenUsedPrevious: Record<string | number, StateMethodsImpl<StateValueAtPath, E>> | undefined;\r\n    private childrenUsed: Record<string | number, StateMethodsImpl<StateValueAtPath, E>> | undefined;\r\n\r\n    private valueUsedNoProxy: boolean | undefined;\r\n    private valueUsedNoProxyPrevious: boolean | undefined;\r\n    private valueUsed: StateValueAtPath = UnusedValue;\r\n\r\n    private selfUsed: State<S, E> | undefined;\r\n\r\n    get [__state](): [Immutable<S>, E] {\r\n        return [this.get(), this.self() as E]\r\n    };\r\n\r\n    constructor(\r\n        public readonly store: Store,\r\n        public path: Path,\r\n        private valueSource: S,\r\n        private valueEdition: number,\r\n        private onSetUsed: () => void\r\n    ) { }\r\n\r\n    reconstruct(path: Path, valueSource: S, valueEdition: number, reset: boolean) {\r\n        this.path = path;\r\n        this.valueSource = valueSource;\r\n        this.valueEdition = valueEdition;\r\n        this.valueUsed = UnusedValue;\r\n\r\n        if (reset) {\r\n            delete this.selfUsed;\r\n            delete this.childrenCreated\r\n            delete this.childrenUsedPrevious\r\n        } else {\r\n            this.valueUsedNoProxyPrevious = this.valueUsedNoProxy;\r\n            this.childrenUsedPrevious = this.childrenUsed;\r\n        }\r\n        delete this.valueUsedNoProxy;\r\n        delete this.childrenUsed\r\n\r\n        // We should not delete subscribers as these are self cleaned up when unmounted\r\n        // Theoretically it is possible to reconnect subscribers like we done it for \r\n        // children, but it is easier and more efficient to leave subscribers to have independent lifecycle\r\n        // If we delete subscribers here, scoped states wrapped in React.memo\r\n        // will lose state change propagation and rerendering for scopped states\r\n        // delete this.subscribers;\r\n    }\r\n\r\n    reconnect() {\r\n        // Mark it's as used, because it is used in a dependency list\r\n        // (we are making it's value used implicitly, so rerender is triggered).\r\n        // Otherwise, no rerender => no effects running, even when a value is changed.\r\n        // This is marking the state used a bit more than it might be really used\r\n        // in the effect callback. More optimized / precise implementation would be\r\n        // to remember useSelf as previous (similar to childrenUsed),\r\n        // but it is a lot more complicated and the benefit is not worth the complexity.\r\n        // So, mark it used.\r\n        // We also using it without proxy if it wass used without proxy during the\r\n        // previous render, because otherwise children usage might be not traced completely\r\n        // and so will not result in renreder if children are updated.\r\n        // This is covered by some tests, but there are so many possible corner cases...\r\n        this.get({ __internalAllowPromised: true, noproxy: this.valueUsedNoProxyPrevious })\r\n        this.childrenUsed = {\r\n            ...this.childrenUsedPrevious,\r\n            ...this.childrenUsed\r\n        }\r\n    }\r\n\r\n    getUntracked(__internalAllowPromised?: boolean) {\r\n        if (this.valueEdition !== this.store.edition) {\r\n            this.valueSource = this.store.get(this.path)\r\n            this.valueEdition = this.store.edition\r\n\r\n            if (this.valueUsed !== UnusedValue) {\r\n                this.valueUsed = UnusedValue\r\n                this.get({ __internalAllowPromised: true }) // renew cache to keep it marked used\r\n            }\r\n        }\r\n        if (__internalAllowPromised) {\r\n            return this.valueSource\r\n        }\r\n        if (this.store.promiseError) {\r\n            throw this.store.promiseError;\r\n        }\r\n        if (this.store.promise) {\r\n            throw new StateInvalidUsageError(this.path, ErrorId.GetStateWhenPromised)\r\n        }\r\n        return this.valueSource;\r\n    }\r\n\r\n    get(options?: { noproxy?: boolean, stealth?: boolean, __internalAllowPromised?: boolean }): Immutable<S> {\r\n        const valueSource = this.getUntracked(options?.__internalAllowPromised)\r\n        if (options?.stealth) {\r\n            return valueSource as Immutable<S>;\r\n        }\r\n        if (this.valueUsed === UnusedValue) {\r\n            if (Array.isArray(valueSource)) {\r\n                this.valueUsed = this.valueArrayImpl(valueSource as unknown as StateValueAtPath[]);\r\n            } else if (Object(valueSource) === valueSource) {\r\n                if ((valueSource as StateValueAtPath).constructor?.name === \"Object\") {\r\n                    this.valueUsed = this.valueObjectImpl(valueSource as unknown as object);\r\n                } else {\r\n                    // any other object except Object, for example Date\r\n                    this.valueUsedNoProxy = true\r\n                    this.valueUsed = valueSource;\r\n                }\r\n            } else {\r\n                this.valueUsed = valueSource;\r\n            }\r\n        }\r\n        if (options?.noproxy) {\r\n            this.valueUsedNoProxy = true\r\n            return valueSource as Immutable<S>;\r\n        }\r\n        return this.valueUsed as Immutable<S>;\r\n    }\r\n\r\n    get value(): Immutable<S> {\r\n        // various tools, including react dev tools and webpack import\r\n        // inspect an object and it's properties\r\n        // so these should not throw\r\n        // return this.get({ __internalAllowPromised: true })\r\n        return this.get()\r\n    }\r\n\r\n    setUntrackedV4(newValue: SetStateAction<S>): SetActionDescriptor | null {\r\n        if (typeof newValue === 'function') {\r\n            newValue = (newValue as ((prevValue: S) => S))(this.getUntracked());\r\n        }\r\n        this.store.preset(this.self() as unknown as State<StateValueAtPath, {}>, newValue)\r\n\r\n        if (Object(newValue) === newValue && newValue![SelfMethodsID]) {\r\n            // TODO check on read instead as it might escape as nested on set anyway\r\n            throw new StateInvalidUsageError(this.path, ErrorId.SetStateToValueFromState)\r\n        }\r\n        if (newValue !== Object(newValue) && newValue === this.getUntracked(true)) {\r\n            // this is primitive value and has not changed\r\n            // so skip this set call as it does not make an effect\r\n            return null\r\n        }\r\n        return this.store.set(this.path, newValue);\r\n    }\r\n\r\n    set(newValue: SetStateAction<S>) {\r\n        let ad = this.setUntrackedV4(newValue);\r\n        if (ad) {\r\n            this.store.update(this.self() as State<StateValueAtPath, StateExtensionUnknown>, ad);\r\n        }\r\n    }\r\n\r\n    mergeUntracked(sourceValue: SetPartialStateAction<S>): Path[] {\r\n        let r = this.mergeUntrackedV4(sourceValue);\r\n        if (r) {\r\n            return [r.path]\r\n        }\r\n        return []\r\n    }\r\n\r\n    mergeUntrackedV4(sourceValue: SetPartialStateAction<S>): SetActionDescriptor | null {\r\n        const currentValue = this.getUntracked()\r\n        if (typeof sourceValue === 'function') {\r\n            sourceValue = (sourceValue as Function)(currentValue);\r\n        }\r\n        this.store.premerge(this.self() as unknown as State<StateValueAtPath, {}>, sourceValue)\r\n\r\n        if (Array.isArray(currentValue)) {\r\n            if (Array.isArray(sourceValue)) {\r\n                let ad: Required<SetActionDescriptor> = { path: this.path, actions: {} };\r\n                sourceValue.forEach((e, i) => {\r\n                    ad.actions[currentValue.push(e) - 1] = \"I\"\r\n                })\r\n                if (Object.keys(ad.actions).length > 0) {\r\n                    this.setUntrackedV4(currentValue)\r\n                    return ad\r\n                }\r\n                return null\r\n            } else {\r\n                let ad: Required<SetActionDescriptor> = { path: this.path, actions: {} };\r\n                const deletedIndexes: number[] = []\r\n                Object.keys(sourceValue as StateValueAtPath)\r\n                    .map(i => Number(i))\r\n                    .sort((a, b) => a - b)\r\n                    .forEach(i => {\r\n                        const index = Number(i);\r\n                        const newPropValue = sourceValue[index]\r\n                        if (newPropValue === none) {\r\n                            ad.actions[index] = \"D\"\r\n                            deletedIndexes.push(index)\r\n                        } else {\r\n                            if (index in currentValue) {\r\n                                ad.actions[index] = \"U\"\r\n                            } else {\r\n                                ad.actions[index] = \"I\"\r\n                            }\r\n                            (currentValue as StateValueAtPath[])[index] = newPropValue\r\n                        }\r\n                    });\r\n                // indexes are ascending sorted as per above\r\n                // so, delete one by one from the end\r\n                // this way index positions do not change\r\n                deletedIndexes.reverse().forEach(p => {\r\n                    (currentValue as unknown as []).splice(p, 1)\r\n                })\r\n                if (Object.keys(ad.actions).length > 0) {\r\n                    this.setUntrackedV4(currentValue)\r\n                    return ad\r\n                }\r\n                return null\r\n            }\r\n        } else if (Object(currentValue) === currentValue) {\r\n            let ad: Required<SetActionDescriptor> = { path: this.path, actions: {} };\r\n            Object.keys(sourceValue as StateValueAtPath).forEach(key => {\r\n                const newPropValue = sourceValue[key]\r\n                if (newPropValue === none) {\r\n                    ad.actions[key] = \"D\"\r\n                    delete currentValue[key]\r\n                } else {\r\n                    if (key in currentValue) {\r\n                        ad.actions[key] = \"U\"\r\n                    } else {\r\n                        ad.actions[key] = \"I\"\r\n                    }\r\n                    currentValue[key] = newPropValue\r\n                }\r\n            })\r\n            if (Object.keys(ad.actions).length > 0) {\r\n                this.setUntrackedV4(currentValue)\r\n                return ad\r\n            }\r\n            return null\r\n        } else if (typeof currentValue === 'string') {\r\n            return this.setUntrackedV4((currentValue + String(sourceValue)) as unknown as S)\r\n        } else {\r\n            return this.setUntrackedV4(sourceValue as S)\r\n        }\r\n    }\r\n\r\n    merge(sourceValue: SetPartialStateAction<S>) {\r\n        let r = this.mergeUntrackedV4(sourceValue);\r\n        if (r) {\r\n            this.store.update(this.self() as State<StateValueAtPath, StateExtensionUnknown>, r)\r\n        }\r\n    }\r\n\r\n    nested<K extends keyof S>(key: K): State<S[K], E> {\r\n        return this.child(key as string | number).self() as State<S[K], E>\r\n    }\r\n\r\n    rerender(paths: Path[]) {\r\n        for (let path of paths) {\r\n            this.store.update(this.self() as State<StateValueAtPath, StateExtensionUnknown>, { path })\r\n        }\r\n    }\r\n\r\n    activate(extensionFactory: ExtensionFactory<any, {}, any> | undefined): void {\r\n        this.store.activate(extensionFactory)\r\n    }\r\n\r\n    deactivate(): void {\r\n        this.store.deactivate()\r\n    }\r\n\r\n    subscribe(l: Subscriber) {\r\n        if (this.subscribers === undefined) {\r\n            this.subscribers = new Set();\r\n        }\r\n        this.subscribers.add(l);\r\n    }\r\n\r\n    unsubscribe(l: Subscriber) {\r\n        if (this.subscribers) {\r\n            this.subscribers.delete(l);\r\n        }\r\n    }\r\n\r\n    get isMounted(): boolean {\r\n        return !this.onSetUsed[IsUnmounted]\r\n    }\r\n\r\n    onMount() {\r\n        delete this.onSetUsed[IsUnmounted];\r\n    }\r\n\r\n    onUnmount() {\r\n        this.onSetUsed[IsUnmounted] = true\r\n    }\r\n\r\n    onSet(ad: SetActionDescriptor, actions: Set<() => void>): boolean {\r\n        const update = () => {\r\n            let isAffected = false\r\n            if (this.valueUsedNoProxy\r\n                // TODO this condition becomes redundant when Downgraded plugins is deleted\r\n                && this.valueUsed !== UnusedValue) {\r\n                actions.add(this.onSetUsed);\r\n                delete this.selfUsed;\r\n                isAffected = true;\r\n            }\r\n            let path = ad.path;\r\n            const nextChildKey = path[this.path.length];\r\n            if (nextChildKey === undefined) {\r\n                // There is no next child to dive into\r\n                // So it is this one which was updated\r\n                if (this.valueUsed !== UnusedValue) {\r\n                    actions.add(this.onSetUsed);\r\n                    delete this.selfUsed;\r\n                    delete this.childrenUsed;\r\n\r\n                    if (ad.actions && this.childrenCreated) {\r\n                        // TODO add automated unit tests for this part\r\n                        if (Array.isArray(this.valueSource)\r\n                            && Object.values(ad.actions).includes(\"D\")) {\r\n                            // this is an array and some elements were removed\r\n                            // so invalidate cache for all children after the first deleted\r\n                            let firstDeletedIndex = Object.keys(ad.actions)\r\n                                .map(i => Number(i))\r\n                                .sort((a, b) => a - b)\r\n                                .find(i => ad.actions?.[i] === \"D\")!\r\n                            for (let childKey in this.childrenCreated) {\r\n                                if (Number(childKey) >= firstDeletedIndex ||\r\n                                    childKey in ad.actions) {\r\n                                    delete this.childrenCreated[childKey]\r\n                                }\r\n                            }\r\n                        } else {\r\n                            for (let childKey in ad.actions) {\r\n                                delete this.childrenCreated[childKey]\r\n                            }\r\n                        }\r\n                    } else {\r\n                        delete this.childrenCreated;\r\n                    }\r\n                    return true;\r\n                }\r\n            } else {\r\n                const nextChild = this.childrenUsed?.[nextChildKey];\r\n                if (nextChild && nextChild.onSet(ad, actions)) {\r\n                    delete this.selfUsed;\r\n                    return true;\r\n                }\r\n            }\r\n            return isAffected;\r\n        }\r\n\r\n        const updated = update();\r\n        if (!updated && this.subscribers !== undefined) {\r\n            this.subscribers.forEach(s => {\r\n                if (s.onSet(ad, actions)) {\r\n                    delete this.selfUsed;\r\n                }\r\n            })\r\n        }\r\n        return updated;\r\n    }\r\n\r\n    get keys(): InferStateKeysType<S> {\r\n        const value = this.get()\r\n        if (Array.isArray(value)) {\r\n            return Object.keys(value).map(i => Number(i)).filter(i => Number.isInteger(i)) as\r\n                unknown as InferStateKeysType<S>;\r\n        }\r\n        if (Object(value) === value) {\r\n            return Object.keys(value as StateValueAtPath) as unknown as InferStateKeysType<S>;\r\n        }\r\n        return undefined as InferStateKeysType<S>;\r\n    }\r\n\r\n    child(key: number | string) {\r\n        this.childrenUsed = this.childrenUsed || {};\r\n        const cachedChild = this.childrenUsed.hasOwnProperty(key) && this.childrenUsed[key];\r\n        if (cachedChild) {\r\n            return cachedChild;\r\n        }\r\n\r\n        const valueSource = this.valueSource[key]\r\n        if (typeof valueSource === 'function') {\r\n            // hitting a method of a custom type, should be no-op\r\n            throw new StateInvalidUsageError(this.path, ErrorId.GetProperty_Function)\r\n        }\r\n        this.childrenCreated = this.childrenCreated || {};\r\n        const child = this.childrenCreated[key];\r\n        let r;\r\n        if (child) {\r\n            child.reconstruct(\r\n                this.path.concat(key),\r\n                valueSource,\r\n                this.valueEdition,\r\n                false\r\n            )\r\n            r = child;\r\n        } else {\r\n            r = new StateMethodsImpl<StateValueAtPath, E>(\r\n                this.store,\r\n                this.path.concat(key),\r\n                valueSource,\r\n                this.valueEdition,\r\n                this.onSetUsed,\r\n            )\r\n            this.childrenCreated[key] = r;\r\n        }\r\n        if (this.valueUsedNoProxy) {\r\n            // TODO this is redundant when Downgraded plugin is deleted\r\n            r.valueUsedNoProxy = true;\r\n        }\r\n        this.childrenUsed[key] = r;\r\n        return r;\r\n    }\r\n\r\n    private valueArrayImpl(currentValue: StateValueAtPath[]): S {\r\n        return proxyWrap(this.path, currentValue,\r\n            () => currentValue,\r\n            (target: object, key: PropertyKey) => {\r\n                if (key === 'length') {\r\n                    return (target as []).length;\r\n                }\r\n                if (key in Array.prototype) {\r\n                    return Array.prototype[key];\r\n                }\r\n                if (key === SelfMethodsID) {\r\n                    return this;\r\n                }\r\n                if (typeof key === 'symbol') {\r\n                    // allow clients to associate hidden cache with state values\r\n                    return target[key];\r\n                }\r\n                const index = Number(key);\r\n                if (!Number.isInteger(index)) {\r\n                    return undefined;\r\n                }\r\n                return this.child(index).get();\r\n            },\r\n            (target: object, key: PropertyKey, value: StateValueAtPath) => {\r\n                if (typeof key === 'symbol') {\r\n                    // allow clients to associate hidden cache with state values\r\n                    target[key] = value;\r\n                    return true;\r\n                }\r\n                throw new StateInvalidUsageError(this.path, ErrorId.SetProperty_Value)\r\n            },\r\n            true\r\n        ) as unknown as S;\r\n    }\r\n\r\n    private valueObjectImpl(currentValue: object): S {\r\n        return proxyWrap(this.path, currentValue,\r\n            () => currentValue,\r\n            (target: object, key: PropertyKey) => {\r\n                if (key in Object.prototype) {\r\n                    return Object.prototype[key];\r\n                }\r\n                if (key === SelfMethodsID) {\r\n                    return this;\r\n                }\r\n                if (typeof key === 'symbol') {\r\n                    // allow clients to associate hidden cache with state values\r\n                    return target[key];\r\n                }\r\n                return this.child(key).get();\r\n            },\r\n            (target: object, key: PropertyKey, value: StateValueAtPath) => {\r\n                if (typeof key === 'symbol') {\r\n                    // allow clients to associate hidden cache with state values\r\n                    target[key] = value;\r\n                    return true;\r\n                }\r\n                throw new StateInvalidUsageError(this.path, ErrorId.SetProperty_Value)\r\n            },\r\n            true\r\n        ) as unknown as S;\r\n    }\r\n\r\n    self(): State<S, E> {\r\n        if (this.selfUsed) {\r\n            return this.selfUsed\r\n        }\r\n\r\n        const getter = (_: object, key: PropertyKey) => {\r\n            if (key === self) {\r\n                return this\r\n            }\r\n            if (typeof key === 'symbol') {\r\n                return undefined\r\n            }\r\n            if (key === 'toJSON') {\r\n                throw new StateInvalidUsageError(this.path, ErrorId.ToJson_State);\r\n            }\r\n\r\n            let nestedGetter = (prop: PropertyKey) => {\r\n                const currentValue = this.get({ __internalAllowPromised: prop === '$$typeof' || prop === 'constructor' });\r\n\r\n                if (prop in Object.prototype) {\r\n                    // Mark it used entirely, so changes to the value\r\n                    // invalidate and rerender results for Object.prototype.toString(),\r\n                    // for example.\r\n                    // We check for Object prototype functions\r\n                    // even for primitive values, because primitive values still\r\n                    // can have object methods.\r\n                    return Object.prototype[prop];\r\n                }\r\n\r\n                if (// if currentValue is primitive type\r\n                    (Object(currentValue) !== currentValue) &&\r\n                    // if promised, it will be none\r\n                    currentValue !== none) {\r\n                    // This was an error case, but various tools like webpack bundler\r\n                    // and react dev tools attempt to get props out of non-null object,\r\n                    // so this was changed to return just undefined for any property request\r\n                    // as there is no way to fix 3rd party tools.\r\n                    // Logging a warning to console is also not an option\r\n                    // as it pollutes console for legitimate apps on app start app.\r\n                    // Ref: https://github.com/avkonst/hookstate/issues/125\r\n                    return undefined\r\n                }\r\n\r\n                if (Array.isArray(currentValue)) {\r\n                    if (prop === 'length') {\r\n                        return currentValue.length;\r\n                    }\r\n                    if (prop in Array.prototype) {\r\n                        return Array.prototype[prop];\r\n                    }\r\n                    const index = Number(prop);\r\n                    if (!Number.isInteger(index)) {\r\n                        return undefined;\r\n                    }\r\n                    return this.nested(index as keyof S)\r\n                }\r\n                return this.nested(prop.toString() as keyof S)\r\n            }\r\n\r\n            switch (key) {\r\n                case 'path':\r\n                    return this.path\r\n                case 'keys':\r\n                    return this.keys\r\n                case 'value':\r\n                    return this.value\r\n                case 'ornull':\r\n                    return this.ornull\r\n                case 'promised':\r\n                    return this.promised\r\n                case 'promise':\r\n                    return this.promise\r\n                case 'error':\r\n                    return this.error\r\n                case 'get':\r\n                    return (opts: { noproxy: boolean, stealth: boolean }) => this.get(opts)\r\n                case 'set':\r\n                    return (p: SetStateAction<S>) => this.set(p)\r\n                case 'merge':\r\n                    return (p: SetPartialStateAction<S>) => this.merge(p)\r\n                case 'nested':\r\n                    return (p: keyof S) => nestedGetter(p)\r\n                default:\r\n                    // check if extension method\r\n                    let ext = this.store.extension\r\n                    if (ext && key in ext) {\r\n                        return ext[key](this.self())\r\n                    }\r\n                    // otherwise nested child\r\n                    return nestedGetter(key)\r\n            }\r\n        }\r\n\r\n        this.selfUsed = proxyWrap(this.path, this.valueSource,\r\n            (opts) => {\r\n                return this.get({ __internalAllowPromised: true, stealth: opts?.stealth });\r\n            },\r\n            getter,\r\n            (_, key, value) => {\r\n                throw new StateInvalidUsageError(this.path, ErrorId.SetProperty_State)\r\n            },\r\n            false) as unknown as State<S, E>;\r\n        return this.selfUsed\r\n    }\r\n\r\n    get promised(): boolean {\r\n        this.get({ __internalAllowPromised: true }) // marks used\r\n        return !!this.store.promise;\r\n    }\r\n\r\n    get promise(): Promise<State<S, E>> | undefined {\r\n        this.get({ __internalAllowPromised: true }) // marks used\r\n        return this.store.promise?.then(_ => this.self());\r\n    }\r\n\r\n    get error(): StateErrorAtRoot | undefined {\r\n        this.get({ __internalAllowPromised: !!this.store.promiseError }) // marks used\r\n        return this.store.promiseError;\r\n    }\r\n\r\n    get ornull(): InferStateOrnullType<S, E> {\r\n        const value = this.get()\r\n        if (value === null || value === undefined) {\r\n            return value as unknown as InferStateOrnullType<S, E>;\r\n        }\r\n        return this.self() as InferStateOrnullType<S, E>;\r\n    }\r\n}\r\n\r\nfunction proxyWrap(\r\n    path: Path,\r\n    // tslint:disable-next-line: no-any\r\n    targetBootstrap: any,\r\n    // tslint:disable-next-line: no-any\r\n    targetGetter: (opts?: { stealth?: boolean }) => any,\r\n    // tslint:disable-next-line: no-any\r\n    propertyGetter: (unused: any, key: PropertyKey) => any,\r\n    // tslint:disable-next-line: no-any\r\n    propertySetter: (unused: any, p: PropertyKey, value: any, receiver: any) => boolean,\r\n    isValueProxy: boolean\r\n) {\r\n    const onInvalidUsage = (op: ErrorId) => {\r\n        throw new StateInvalidUsageError(path, op)\r\n    }\r\n    if (Object(targetBootstrap) !== targetBootstrap) {\r\n        targetBootstrap = {}\r\n    }\r\n    return new Proxy(targetBootstrap, {\r\n        getPrototypeOf: (_target) => {\r\n            // should satisfy the invariants:\r\n            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getPrototypeOf#Invariants\r\n            const targetReal = targetGetter()\r\n            if (targetReal === undefined || targetReal === null) {\r\n                return null;\r\n            }\r\n            if (targetReal === none) {\r\n                return Object.getPrototypeOf(new Promise(() => { }));\r\n            }\r\n            return Object.getPrototypeOf(targetReal);\r\n        },\r\n        setPrototypeOf: (_target, v) => {\r\n            return onInvalidUsage(isValueProxy ?\r\n                ErrorId.SetPrototypeOf_State :\r\n                ErrorId.SetPrototypeOf_Value)\r\n        },\r\n        isExtensible: (_target) => {\r\n            // should satisfy the invariants:\r\n            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/isExtensible#Invariants\r\n            return true; // required to satisfy the invariants of the getPrototypeOf\r\n            // return Object.isExtensible(target);\r\n        },\r\n        preventExtensions: (_target) => {\r\n            return onInvalidUsage(isValueProxy ?\r\n                ErrorId.PreventExtensions_State :\r\n                ErrorId.PreventExtensions_Value)\r\n        },\r\n        getOwnPropertyDescriptor: (_target, p) => {\r\n            const targetReal = targetGetter()\r\n\r\n            if (Object(targetReal) === targetReal) {\r\n                const origin = Object.getOwnPropertyDescriptor(targetReal, p);\r\n                if (Array.isArray(targetReal) && p in Array.prototype) {\r\n                    return origin;\r\n                }\r\n                return origin && {\r\n                    // should be configurable as may not exist on proxy target\r\n                    configurable: true, // JSON.stringify() does not work for an object without it\r\n                    enumerable: origin.enumerable,\r\n                    get: () => propertyGetter(targetReal, p),\r\n                    set: undefined\r\n                };\r\n            }\r\n\r\n            if (isValueProxy || targetReal === none) {\r\n                return undefined;\r\n            }\r\n            if (p === 'value') {\r\n                return {\r\n                    // should be configurable as does not exist on proxy target\r\n                    configurable: true,\r\n                    enumerable: true,\r\n                    get: () => targetGetter({ stealth: true }),\r\n                    set: undefined\r\n                };\r\n            }\r\n            if (p === 'path') {\r\n                return {\r\n                    // should be configurable as does not exist on proxy target\r\n                    configurable: true,\r\n                    enumerable: true,\r\n                    get: () => path,\r\n                    set: undefined\r\n                };\r\n            }\r\n            return undefined;\r\n        },\r\n        has: (_target, p) => {\r\n            if (typeof p === 'symbol') {\r\n                return false;\r\n            }\r\n            const targetReal = targetGetter()\r\n            if (Object(targetReal) === targetReal) {\r\n                return p in targetReal;\r\n            }\r\n            if (isValueProxy || targetReal === none) {\r\n                return false;\r\n            }\r\n            return p === 'value' || p === 'path';\r\n        },\r\n        get: propertyGetter,\r\n        set: propertySetter,\r\n        deleteProperty: (_target, p) => {\r\n            return onInvalidUsage(isValueProxy ?\r\n                ErrorId.DeleteProperty_State :\r\n                ErrorId.DeleteProperty_Value)\r\n        },\r\n        defineProperty: (_target, p, attributes) => {\r\n            return onInvalidUsage(isValueProxy ?\r\n                ErrorId.DefineProperty_State :\r\n                ErrorId.DefineProperty_Value)\r\n        },\r\n        ownKeys: (_target) => {\r\n            const targetReal = targetGetter()\r\n            if (Array.isArray(targetReal)) {\r\n                if (_target.length === undefined) {\r\n                    // an object turned into an array now\r\n                    // inject length property now as it is defined on the array\r\n                    // to enable getOwnPropertyDescriptor for length not throw\r\n                    Object.defineProperty(targetBootstrap, 'length', {\r\n                        value: 0, writable: true, enumerable: false, configurable: false\r\n                    })\r\n                }\r\n            }\r\n            if (Object(targetReal) === targetReal) {\r\n                return Object.getOwnPropertyNames(targetReal);\r\n            }\r\n            if (isValueProxy || targetReal === none) {\r\n                return []\r\n            }\r\n            return ['value', 'path']\r\n        },\r\n        apply: (_target, thisArg, argArray?) => {\r\n            return onInvalidUsage(isValueProxy ?\r\n                ErrorId.Apply_State :\r\n                ErrorId.Apply_Value)\r\n        },\r\n        construct: (_target, argArray, newTarget?) => {\r\n            return onInvalidUsage(isValueProxy ?\r\n                ErrorId.Construct_State :\r\n                ErrorId.Construct_Value)\r\n        }\r\n    });\r\n}\r\n\r\nfunction createStore<S, E>(initial: SetInitialStateAction<S>): Store {\r\n    let initialValue: S | Promise<S> = initial as (S | Promise<S>);\r\n    if (typeof initial === 'function') {\r\n        initialValue = (initial as (() => S | Promise<S>))();\r\n    }\r\n    if (Object(initialValue) === initialValue && initialValue[SelfMethodsID]) {\r\n        throw new StateInvalidUsageError(RootPath, ErrorId.InitStateToValueFromState)\r\n    }\r\n    return new Store(initialValue);\r\n}\r\n\r\n/**\r\n * A type of an argument of the configure function\r\n */\r\nexport interface Configuration {\r\n    /**\r\n     * By default Hookstate intercepts calls to useEffect, useMemo and\r\n     * other functions where a dependency lists are used as arguments.\r\n     * This allows these hook functions to have Hookstate State objects\r\n     * in dependency lists and everything to work as 'expected'.\r\n     * \r\n     * It is possible to opt-out from this mode, configuring the option to never.\r\n     * \r\n     * Alternatively, it is possible to set it to intercept only during development,\r\n     * which will raise HOOKSTATE-100 error whenever Hookstate State is used in a dependency list of standard React hook function.\r\n     * This error can be fixed by replacing standard React hooks by Hookstate provided hooks,\r\n     * for example useEffect by useHookstateEffect\r\n     */\r\n    interceptDependencyListsMode: 'always' | 'development' | 'never',\r\n    /**\r\n     * Defines is Hookstate is running in a development mode.\r\n     * Development mode enables additional checking and HMR support.\r\n     * By default, it detects if process.env.NODE_ENV is set to 'development'.\r\n     * It might not work in all environments and so expected to be provided by an application explicitly.\r\n     */\r\n    isDevelopmentMode: boolean,\r\n    /**\r\n     * A callback which allows Hookstate to detect if a provided variable is a promise or not.\r\n     * This allows to enable Hookstate working in Angular environment when Promises are wrapped by zone.js,\r\n     * which breaks standard promise resolution / detection convention.\r\n     */\r\n    promiseDetector: (p: any) => boolean,\r\n}\r\nlet configuration: Configuration & { hiddenInterceptDependencyListsModeDebug: boolean } = {\r\n    interceptDependencyListsMode: 'always',\r\n    isDevelopmentMode: typeof process === 'object' &&\r\n        typeof process.env === 'object' &&\r\n        process.env.NODE_ENV === 'development',\r\n    promiseDetector: (p) => Promise.resolve(p) === p,\r\n    hiddenInterceptDependencyListsModeDebug: false\r\n}\r\n\r\n/**\r\n * Configures Hookstate behavior globally. This is for special cases only, when default\r\n * heuristics fail to work in a specific environment.\r\n * \r\n * @param config \r\n */\r\nexport function configure(config: Partial<Configuration>) {\r\n    configuration = {\r\n        interceptDependencyListsMode: config.interceptDependencyListsMode ?? configuration.interceptDependencyListsMode,\r\n        isDevelopmentMode: config.isDevelopmentMode ?? configuration.isDevelopmentMode,\r\n        promiseDetector: config.promiseDetector ?? configuration.promiseDetector,\r\n        hiddenInterceptDependencyListsModeDebug: false\r\n    }\r\n\r\n    interceptReactHooks() // not really required, but for safety\r\n\r\n    if (configuration.interceptDependencyListsMode === 'never') {\r\n        configuration.hiddenInterceptDependencyListsModeDebug = false;\r\n        React['useEffect'] = React['useEffect'] && useEffectOrigin;\r\n        React['useLayoutEffect'] = React['useLayoutEffect'] && useLayoutEffectOrigin;\r\n        React['useInsertionEffect'] = React['useInsertionEffect'] && useInsertionEffectOrigin;\r\n        React['useImperativeHandle'] = React['useImperativeHandle'] && useImperativeHandleOrigin;\r\n        React['useMemo'] = React['useMemo'] && useMemoOrigin;\r\n        React['useCallback'] = React['useCallback'] && useCallbackOrigin;\r\n        // the following does not make an effect as memo calls happen on module load\r\n        // so it is always set to memoIntercept\r\n        React['memo'] = React['memo'] && memoOrigin as any;\r\n    } else {\r\n        // do not intercept if a hook is not defined in React\r\n        // otherwise, it will enable 3rd party libs thinking the react runs at version 18\r\n        React['useEffect'] = React['useEffect'] && useEffectIntercept;\r\n        React['useLayoutEffect'] = React['useLayoutEffect'] && useLayoutEffectIntercept;\r\n        React['useInsertionEffect'] = React['useLayoutEffect'] && useInsertionEffectIntercept;\r\n        React['useImperativeHandle'] = React['useImperativeHandle'] && useImperativeHandleIntercept;\r\n        React['useMemo'] = React['useMemo'] && useMemoIntercept;\r\n        React['useCallback'] = React['useCallback'] && useCallbackIntercept;\r\n        // the following does not make an effect as memo calls happen on module load\r\n        // so it is always set to memoIntercept\r\n        React['memo'] = React['memo'] && memoIntercept as any;\r\n        if (configuration.interceptDependencyListsMode === 'development'\r\n            && configuration.isDevelopmentMode) {\r\n            configuration.hiddenInterceptDependencyListsModeDebug = true;\r\n        }\r\n    }\r\n}\r\n\r\nfunction reconnectDependencies(deps?: React.DependencyList, fromIntercept?: boolean): React.DependencyList | undefined {\r\n    for (const i of deps || []) {\r\n        if (i === Object(i)) {\r\n            let state = (i as any)[self] as StateMethodsImpl<StateValueAtPath, {}> | undefined\r\n            if (state) {\r\n                if (fromIntercept && configuration.hiddenInterceptDependencyListsModeDebug) {\r\n                    throw new StateInvalidUsageError(state.path, ErrorId.StateUsedInDependencyList)\r\n                }\r\n                state.reconnect()\r\n            }\r\n        }\r\n    }\r\n    return deps;\r\n}\r\n\r\nlet useEffectOrigin: (effect: React.EffectCallback, deps?: React.DependencyList) => void;\r\nexport function useHookstateEffect(effect: React.EffectCallback, deps?: React.DependencyList) {\r\n    reconnectDependencies(deps)\r\n    return useEffectOrigin(effect, deps)\r\n}\r\nfunction useEffectIntercept(effect: React.EffectCallback, deps?: React.DependencyList) {\r\n    reconnectDependencies(deps, true)\r\n    return useEffectOrigin(effect, deps)\r\n}\r\n\r\nlet useLayoutEffectOrigin: (effect: React.EffectCallback, deps?: React.DependencyList) => void;\r\nexport function useHookstateLayoutEffect(effect: React.EffectCallback, deps?: React.DependencyList) {\r\n    reconnectDependencies(deps)\r\n    return useLayoutEffectOrigin(effect, deps)\r\n}\r\nfunction useLayoutEffectIntercept(effect: React.EffectCallback, deps?: React.DependencyList) {\r\n    reconnectDependencies(deps, true)\r\n    return useLayoutEffectOrigin(effect, deps)\r\n}\r\n\r\nlet useInsertionEffectOrigin: (effect: React.EffectCallback, deps?: React.DependencyList) => void;\r\nexport function useHookstateInsertionEffect(effect: React.EffectCallback, deps?: React.DependencyList) {\r\n    reconnectDependencies(deps)\r\n    return useInsertionEffectOrigin(effect, deps)\r\n}\r\nfunction useInsertionEffectIntercept(effect: React.EffectCallback, deps?: React.DependencyList) {\r\n    reconnectDependencies(deps, true)\r\n    return useInsertionEffectOrigin(effect, deps)\r\n}\r\n\r\nlet useImperativeHandleOrigin: <T, R extends T>(ref: React.Ref<T> | undefined, init: () => R, deps?: React.DependencyList) => void;\r\nexport function useHookstateImperativeHandle<T, R extends T>(ref: React.Ref<T> | undefined, init: () => R, deps?: React.DependencyList): void {\r\n    reconnectDependencies(deps)\r\n    return useImperativeHandleOrigin(ref, init, deps)\r\n}\r\nfunction useImperativeHandleIntercept<T, R extends T>(ref: React.Ref<T> | undefined, init: () => R, deps?: React.DependencyList): void {\r\n    reconnectDependencies(deps, true)\r\n    return useImperativeHandleOrigin(ref, init, deps)\r\n}\r\n\r\nlet useMemoOrigin: <T>(factory: () => T, deps: React.DependencyList | undefined) => T;\r\nexport function useHookstateMemo<T>(factory: () => T, deps: React.DependencyList | undefined): T {\r\n    reconnectDependencies(deps)\r\n    return useMemoOrigin(factory, deps)\r\n}\r\nfunction useMemoIntercept<T>(factory: () => T, deps: React.DependencyList | undefined): T {\r\n    reconnectDependencies(deps, true)\r\n    return useMemoOrigin(factory, deps)\r\n}\r\n\r\nlet useCallbackOrigin: <T extends Function>(callback: T, deps: React.DependencyList) => T;\r\nexport function useHookstateCallback<T extends Function>(callback: T, deps: React.DependencyList): T {\r\n    reconnectDependencies(deps)\r\n    return useCallbackOrigin(callback, deps)\r\n}\r\nfunction useCallbackIntercept<T extends Function>(callback: T, deps: React.DependencyList): T {\r\n    reconnectDependencies(deps, true)\r\n    return useCallbackOrigin(callback, deps)\r\n}\r\n\r\nlet memoOrigin: <P extends object>(\r\n    Component: React.FunctionComponent<P>,\r\n    propsAreEqual?: (prevProps: Readonly<P>, nextProps: Readonly<P>) => boolean\r\n) => React.NamedExoticComponent<P>;\r\nexport function hookstateMemo<T extends React.ComponentType<any>>(\r\n    Component: T,\r\n    propsAreEqual?: (prevProps: Readonly<React.ComponentProps<T>>, nextProps: Readonly<React.ComponentProps<T>>) => boolean\r\n): React.MemoExoticComponent<T>;\r\nexport function hookstateMemo<P extends object>(\r\n    Component: React.FunctionComponent<P>,\r\n    propsAreEqual?: (prevProps: Readonly<P>, nextProps: Readonly<P>) => boolean\r\n): React.NamedExoticComponent<P> {\r\n    return memoOrigin(Component, (prevProps, nextProps) => {\r\n        reconnectDependencies(Object.keys(nextProps).map(i => nextProps[i]))\r\n        return (propsAreEqual || shallowEqual)(prevProps, nextProps)\r\n    })\r\n}\r\nfunction memoIntercept<T extends React.ComponentType<any>>(\r\n    Component: T,\r\n    propsAreEqual?: (prevProps: Readonly<React.ComponentProps<T>>, nextProps: Readonly<React.ComponentProps<T>>) => boolean\r\n): React.MemoExoticComponent<T>;\r\nfunction memoIntercept<P extends object>(\r\n    Component: React.FunctionComponent<P>,\r\n    propsAreEqual?: (prevProps: Readonly<P>, nextProps: Readonly<P>) => boolean\r\n): React.NamedExoticComponent<P> {\r\n    return memoOrigin(Component, (prevProps, nextProps) => {\r\n        reconnectDependencies(Object.keys(nextProps).map(i => nextProps[i]), true)\r\n        return (propsAreEqual || shallowEqual)(prevProps, nextProps)\r\n    })\r\n}\r\n\r\nfunction interceptReactHooks() {\r\n    if (!useEffectOrigin && React['useEffect']) {\r\n        useEffectOrigin = React['useEffect'];\r\n        React['useEffect'] = useEffectIntercept;\r\n    }\r\n    if (!useLayoutEffectOrigin && React['useLayoutEffect']) {\r\n        useLayoutEffectOrigin = React['useLayoutEffect'];\r\n        React['useLayoutEffect'] = useLayoutEffectIntercept;\r\n    }\r\n    if (!useInsertionEffectOrigin && React['useInsertionEffect']) {\r\n        useInsertionEffectOrigin = React['useInsertionEffect'];\r\n        React['useInsertionEffect'] = useInsertionEffectIntercept;\r\n    }\r\n    if (!useImperativeHandleOrigin && React['useImperativeHandle']) {\r\n        useImperativeHandleOrigin = React['useImperativeHandle'];\r\n        React['useImperativeHandle'] = useImperativeHandleIntercept;\r\n    }\r\n    if (!useMemoOrigin && React['useMemo']) {\r\n        useMemoOrigin = React['useMemo'];\r\n        React['useMemo'] = useMemoIntercept;\r\n    }\r\n    if (!useCallbackOrigin && React['useCallback']) {\r\n        useCallbackOrigin = React['useCallback'];\r\n        React['useCallback'] = useCallbackIntercept;\r\n    }\r\n    if (!memoOrigin && React['memo']) {\r\n        memoOrigin = React['memo'];\r\n        React['memo'] = memoIntercept;\r\n    }\r\n}\r\ninterceptReactHooks() // TODO defer invoking it until state is created, so the configure had a chance to set it up first\r\n\r\n// Do not try to use useLayoutEffect if DOM not available (SSR)\r\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffectOrigin! : useEffectOrigin!;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}